<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>הסניף הדיגיטלי</title>
<style>
  :root {
    --fg: #f7f7f2;
    --glass: rgba(0, 0, 0, .55);
    --glass-brd: rgba(255, 255, 255, .08);
    --accent: #22d3ee;
    --btn: #2b7bff;
  }
  body {
    font-family: 'Heebo', system-ui;
    background: url('background.png') center/cover no-repeat fixed;
    color: var(--fg);
    margin: 0;
    text-align: center;
  }

  .overlay {
    width: min(640px, 94%);
    margin: 110px auto 20px;            /* ממוקם מתחת לעץ */
    padding: 18px 14px 20px;
    background: var(--glass);
    border: 1px solid var(--glass-brd);
    border-radius: 18px;
    box-shadow: 0 0 20px rgba(0, 0, 0, .4);
  }

  h1 { margin: 6px 0 8px; font-size: 1.95rem; line-height: 1.1; }

  .section {
    background: rgba(0,0,0,.53);
    border: 1px solid var(--glass-brd);
    border-radius: 12px;
    padding: 12px;
    margin: 12px auto 0;
    text-align: right;
  }

  a { color: var(--accent); font-weight: 600; text-decoration: underline; }

  .club-code { font-size: 1.9rem; font-weight: 800; }
  .copy-btn { background-color: var(--btn); color: #fff; border: none; border-radius: 6px; padding: 6px 10px; cursor: pointer; }
  .copy-btn:hover { background:#1b63e8; }

  /* אייקוני חנויות – קטנים ונקיים */
  .store-links { display: flex; justify-content: center; gap: 10px; margin-top: 6px; }
  .store-links a { background: rgba(255,255,255,0.1); padding: 4px 6px; border-radius: 8px; transition: transform .2s ease, background .2s ease; }
  .store-links a:hover { transform: scale(1.05); background: rgba(255,255,255,0.18); }
  .store-icon { width: 65px; opacity: .95; }

  .btn-wa { background: linear-gradient(135deg, #0b7a55, #064e3b); color: #fff; border: none; border-radius: 22px; padding: 9px 14px; font-size: .95rem; cursor: pointer; margin-top: 8px; }

  .tiny-note { font-size: .86em; opacity: .92; margin-top: 6px; }
  .micro-note { font-size: .76em; opacity: .87; margin-top: 4px; }

  footer { margin-top: 14px; font-weight: 700; font-size: 1.05rem; color: #ffdf91; }
  .footer-sub { font-weight: 500; font-size: .83rem; color: #ffe9b6; margin-top: 6px; }

  /* ===== מודלים – עם אנימציית פייד-אין + טשטוש ===== */
  .modal{
    position:fixed; inset:0; z-index:9999;
    display:flex; align-items:center; justify-content:center;
    opacity:0; visibility:hidden; pointer-events:none;
    background:rgba(0,0,0,0);
    transition: opacity .25s ease, visibility .25s ease, background .25s ease;
    backdrop-filter: blur(0px);
  }
  .modal.show{
    opacity:1; visibility:visible; pointer-events:auto;
    background:rgba(0,0,0,.55);
    backdrop-filter: blur(4px);
  }
  .modal-box{
    background: rgba(1,59,51,.96);
    border: 1px solid rgba(255,255,255,.15);
    width: min(380px, 92%);
    color: #fff; text-align: center;
    padding: 18px; border-radius: 14px;
    box-shadow: 0 10px 30px rgba(0,0,0,.35);
    transform: translateY(8px) scale(.98);
    opacity: 0;
    transition: transform .28s cubic-bezier(.2,.7,.2,1), opacity .28s ease;
  }
  .modal.show .modal-box{
    transform: translateY(0) scale(1);
    opacity: 1;
  }
  .modal-box h3 { margin: 0 0 8px; color: #ffdf91; font-size: 1.2rem; }
  .modal-box p { margin: 8px 0; line-height: 1.4; }
  .modal-actions { margin-top: 10px; display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }
  .btn { border: none; border-radius: 8px; padding: 8px 14px; cursor: pointer; color: #fff; background: var(--btn); }
  .btn:hover { background: #1b63e8; }
  .btn-ghost { background: transparent; border: 1px solid rgba(255,255,255,.3); }
  .btn-ghost:hover { background: rgba(255,255,255,.1); }

  .input { width: 86%; padding: 10px; border-radius: 10px; border: none; text-align: center; font-size: 1rem; outline: none; background: rgba(255,255,255,.15); color: #fff; display:block; margin: 0 auto 8px; }
  .input::placeholder { color: #e8e8e8; opacity: .75; }
  .select { width: 86%; padding: 10px; border-radius: 10px; border: none; text-align: center; font-size: 1rem; outline: none; background: rgba(255,255,255,.15); color: #fff; display:block; margin: 0 auto 8px; cursor:pointer; }
</style>
</head>
<body>
  <div class="overlay">
    <h1>הסניף הדיגיטלי</h1>

    <!-- אפליקציה -->
    <div class="section">
      <h2>אפליקציה</h2>
      <div><b>קוד מועדון:</b> <span class="club-code" id="clubCode">715965</span>
        <button class="copy-btn" onclick="copyText(document.getElementById('clubCode').textContent)">📋 העתק</button>
      </div>
      <div class="store-links">
        <a href="https://apps.apple.com/us/app/clubgg-poker/id1529839330" target="_blank" rel="noopener"><img src="app store.png" alt="App Store" class="store-icon"></a>
        <a href="https://play.google.com/store/apps/details?id=com.nsus.clubgg" target="_blank" rel="noopener"><img src="android.png" alt="Android" class="store-icon"></a>
      </div>
    </div>

    <!-- טעינות -->
    <div class="section">
      <h2>🔋 טעינות</h2>
      <div>🔗 <b>Paybox:</b> <a href="https://links.payboxapp.com/9kD9tKtOhWb" target="_blank" rel="noopener">טען עכשיו ב-Paybox</a></div>
      <button class="btn-wa" onclick="startWhatsappFlow()">אין לך PayBox? דבר איתי ב-WhatsApp 💬</button>
      <div class="tiny-note">💬 בכל טעינה, לשלוח צילום מסך וכינוי.</div>
      <div class="tiny-note"><b>יחס צ׳יפים 1:10</b></div>
    </div>

    <!-- משיכות -->
    <div class="section">
      <h2>💸 משיכות</h2>
      <div>כל יום שלישי בין <b>18:00</b> ל-<b>00:00</b></div>
      <a href="https://chat.whatsapp.com/GDw1GilqCab6Un2TspiWBP?mode=wwc" target="_blank" rel="noopener" id="withdrawGroupLink">
        💬 לקבוצת ה-WhatsApp לביצוע משיכות לחצו כאן
      </a>
      <!-- (לבקשתך הסרנו את שורת ההערה הקטנה) -->
    </div>

    <footer>
      ⚠️ שחקו באחריות
      <div class="footer-sub">🤝 שמרו על הקהילה שלנו – לא מפרסמים קלאבים או משחקים אחרים.</div>
      <div class="footer-sub">אנחנו כאן כדי ליהנות יחד, באווירה טובה ומשפחה אחת</div>
    </footer>
  </div>

  <!-- מודל טעינה (סכום + כינוי) -->
  <div id="amountModal" class="modal" aria-hidden="true">
    <div class="modal-box">
      <h3>💰 פרטי טעינה</h3>
      <p>נא להזין סכום טעינה וכינוי באפליקציה:</p>
      <input type="number" id="amountInput" class="input" placeholder="כמה לטעון? (₪)" inputmode="numeric" />
      <input type="text" id="nicknameInput" class="input" placeholder="כינוי באפליקציה" maxlength="30" />
      <div class="modal-actions">
        <button class="btn" onclick="confirmAmount()">שלח</button>
        <button class="btn-ghost" onclick="closeAmountModal()">ביטול</button>
      </div>
    </div>
  </div>

  <!-- מודל 'לא כרגע' למשיכות מחוץ לשעות -->
  <div id="withdrawBlockedModal" class="modal" aria-hidden="true">
    <div class="modal-box">
      <h3>🕓 לא כרגע</h3>
      <p>המשיכות מתבצעות רק בין 18:00–00:00.<br>המועד הקרוב: <span id="nextWithdrawDate"></span> בין 18:00–00:00.</p>
      <div class="modal-actions">
        <button class="btn" onclick="closeWithdrawBlocked()">הבנתי</button>
      </div>
    </div>
  </div>

  <!-- מודל טופס משיכה (4 שדות) -->
  <div id="withdrawFormModal" class="modal" aria-hidden="true">
    <div class="modal-box">
      <h3>בקשת משיכה 💸</h3>
      <p>מלא/י את הפרטים, ונכין לך הודעה לקבוצה:</p>
      <input id="wdAmount" class="input" type="number" min="1" step="1" placeholder="כמה למשוך? (₪)" inputmode="numeric" />
      <input id="wdKeep" class="input" type="number" min="0" step="1" placeholder="כמה להשאיר? (₪)" inputmode="numeric" />
      <input id="wdNick" class="input" type="text" maxlength="30" placeholder="כינוי באפליקציה" />
      <select id="wdMethod" class="select" aria-label="אופן תשלום">
        <option value="">בחר אופן תשלום</option>
        <option value="ביט">ביט</option>
        <option value="פייבוקס">פייבוקס</option>
      </select>
      <div class="modal-actions">
        <button class="btn" onclick="confirmWithdraw()">אישור</button>
        <button class="btn-ghost" onclick="closeWithdrawForm()">ביטול</button>
      </div>
    </div>
  </div>

<script>
  /* ========= נתונים ========= */
  const PHONES = { "מאור": "972546819166" };

  /* ========= דגל בדיקות לאכיפה =========
     true  = אכיפה פעילה (פרודקשן)
     false = הכל פתוח לצורכי בדיקה
  */
  const ENFORCE_WITHDRAW_RULES = true;

  /* ========= רפרנסים למודלים ========= */
  const amountModal = document.getElementById('amountModal');
  const amountInput = document.getElementById('amountInput');
  const nicknameInput = document.getElementById('nicknameInput');
  let pendingPhone = null;

  const withdrawLink = document.getElementById('withdrawGroupLink');
  const withdrawBlockedModal = document.getElementById('withdrawBlockedModal');
  const withdrawFormModal = document.getElementById('withdrawFormModal');
  const nextDateSpan = document.getElementById('nextWithdrawDate');

  const wdAmount = document.getElementById('wdAmount');
  const wdKeep   = document.getElementById('wdKeep');
  const wdNick   = document.getElementById('wdNick');
  const wdMethod = document.getElementById('wdMethod');

  const WITHDRAW_GROUP_URL = "https://chat.whatsapp.com/GDw1GilqCab6Un2TspiWBP?mode=wwc";

  /* ========= זמן מקומי ========= */
  function nowIL(){
    const d = new Date();
    const parts = new Intl.DateTimeFormat("he-IL", {
      timeZone:"Asia/Jerusalem", hour12:false, hour:"2-digit", minute:"2-digit", weekday:"short"
    }).formatToParts(d);
    const get = t => parts.find(x=>x.type===t)?.value;
    const h = +get("hour"), m = +get("minute");
    const wd = get("weekday");
    const map = {"יום א׳":0, "יום ב׳":1, "יום ג׳":2, "יום ד׳":3, "יום ה׳":4, "יום ו׳":5, "יום ש׳":6, "יום שבת":6};
    return { day: map[wd] ?? d.getDay(), minutes: h*60 + m };
  }

  function isWithdrawWindowOpen(){
    if (!ENFORCE_WITHDRAW_RULES) return true; // מצב בדיקה: הכל פתוח
    const n = nowIL();
    return n.day === 2 && n.minutes >= 18*60 && n.minutes < 24*60; // שלישי 18:00–00:00
  }

  function nextWithdrawDateString(){
    const n = nowIL(); const now = new Date();
    const TUE = 2, start = 18*60;
    let addDays;
    if (n.day === TUE && n.minutes < start) addDays = 0;
    else { addDays = (TUE - n.day + 7) % 7; if (addDays === 0) addDays = 7; }
    const target = new Date(now.getFullYear(), now.getMonth(), now.getDate() + addDays);
    return new Intl.DateTimeFormat('he-IL', { timeZone:'Asia/Jerusalem', day:'2-digit', month:'2-digit', year:'numeric' }).format(target);
  }

  /* ========= טעינות (מודאל + וואטסאפ) ========= */
  function startWhatsappFlow(){
    // אם תרצה רוטציה של משמרות – כאן תוכל לבחור למי לשלוח
    const fallback = PHONES["מאור"];
    pendingPhone = fallback;

    amountModal.classList.add('show');
    setTimeout(()=> (amountInput.value ? nicknameInput : amountInput).focus(), 80);
  }
  function closeAmountModal(){ amountModal.classList.remove('show'); }

  function confirmAmount(){
    const rawAmount = (amountInput.value || '').trim();
    const nick = (nicknameInput.value || '').trim();
    const amount = Math.floor(Number(rawAmount));

    if(!rawAmount || !Number.isFinite(amount) || amount <= 0){ amountInput.focus(); amountInput.select?.(); return; }
    if(nick.length < 2){ nicknameInput.focus(); return; }

    const msg = `היי! רוצה להטעין לסניף הדיגיטלי סכום של ${amount} ₪.\nהכינוי שלי באפליקציה: ${nick}`;
    window.open(`https://api.whatsapp.com/send?phone=${pendingPhone}&text=${encodeURIComponent(msg)}`, "_blank");

    amountInput.value = ""; nicknameInput.value = "";
    closeAmountModal();
  }

  /* ========= משיכות ========= */
  // בלחיצה על קישור הקבוצה: אם מותר – פותחים טופס; אם לא – מודאל "לא כרגע"
  withdrawLink.addEventListener('click', (e)=>{
    if (!isWithdrawWindowOpen()){
      e.preventDefault();
      nextDateSpan.textContent = nextWithdrawDateString();
      withdrawBlockedModal.classList.add('show');
    } else {
      e.preventDefault(); // לא לפתוח את הקבוצה עדיין — קודם טופס
      openWithdrawForm();
    }
  });

  function openWithdrawForm(){
    withdrawFormModal.classList.add('show');
    setTimeout(()=> wdAmount.focus(), 80);
  }
  function closeWithdrawForm(){ withdrawFormModal.classList.remove('show'); }
  function closeWithdrawBlocked(){ withdrawBlockedModal.classList.remove('show'); }

  function confirmWithdraw(){
    const rawA = (wdAmount.value || '').trim();
    const rawK = (wdKeep.value || '').trim();
    const nick = (wdNick.value || '').trim();
    const method = wdMethod.value;

    const amount = Math.floor(Number(rawA));
    const keep = Math.floor(Number(rawK || "0"));

    if(!rawA || !Number.isFinite(amount) || amount <= 0){ wdAmount.focus(); wdAmount.select?.(); return; }
    if(keep < 0){ wdKeep.focus(); wdKeep.select?.(); return; }
    if(nick.length < 2){ wdNick.focus(); return; }
    if(method !== 'ביט' && method !== 'פייבוקס'){ wdMethod.focus(); return; }

    const text =
      `בקשת משיכה:\n` +
      `• סכום למשיכה: ${amount} ₪\n` +
      `• להשאיר: ${keep} ₪\n` +
      `• כינוי באפליקציה: ${nick}\n` +
      `• אופן תשלום: ${method}`;

    // פותח את קבוצת הווטסאפ שלך עם ההודעה מוכנה
    window.open(`${WITHDRAW_GROUP_URL}&text=${encodeURIComponent(text)}`, "_blank");

    wdAmount.value=""; wdKeep.value=""; wdNick.value=""; wdMethod.value="";
    closeWithdrawForm();
  }

  /* ========= כלי ========= */
  function copyText(t){ navigator.clipboard.writeText(t); alert("הועתק!"); }
</script>
</body>
</html>

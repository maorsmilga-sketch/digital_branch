<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>הסניף הדיגיטלי</title>
<style>

  .clubgg-logo {
  width: 38px;
  vertical-align: middle;
  margin-left: 8px;
  border-radius: 8px;
}

  :root{
    --fg:#f7f7f2; --glass:rgba(0,0,0,.55); --glass-brd:rgba(255,255,255,.08);
    --accent:#22d3ee; --btn:#2b7bff;
  }
  body{
    font-family:'Heebo',system-ui;
    background:url('background.png') center/cover no-repeat fixed;
    color:var(--fg); margin:0; text-align:center;
  }
  .overlay{
    width:min(640px,94%); margin:110px auto 20px; padding:18px 14px 20px;
    background:var(--glass); border:1px solid var(--glass-brd);
    border-radius:18px; box-shadow:0 0 20px rgba(0,0,0,.4);
  }
  h1{ margin:6px 0 8px; font-size:1.95rem; line-height:1.1; }

  .section{
    background:rgba(0,0,0,.53); border:1px solid var(--glass-brd);
    border-radius:12px; padding:12px; margin:12px auto 0; text-align:right;
  }
  a{ color:var(--accent); font-weight:600; text-decoration:underline; }

  .club-code{ font-size:1.9rem; font-weight:800; }
  .copy-btn{ background:var(--btn); color:#fff; border:none; border-radius:6px; padding:6px 10px; cursor:pointer; }
  .copy-btn:hover{ background:#1b63e8; }

  .store-links{ display:flex; justify-content:center; gap:10px; margin-top:6px; }
  .store-links a{ background:rgba(255,255,255,.1); padding:4px 6px; border-radius:8px; transition:.2s; }
  .store-links a:hover{ transform:scale(1.05); background:rgba(255,255,255,.18); }
  .store-icon{ width:65px; opacity:.95; }

  .tiny-note{
  font-size:.86em;
  opacity:.92;
  margin-top:6px;
  text-align:center;   /* ← זה ממורכז */
}
  footer{ margin-top:14px; font-weight:700; font-size:1.05rem; color:#ffdf91; }
  .footer-sub{ font-weight:500; font-size:.83rem; color:#ffe9b6; margin-top:6px; }

  /* ===== כפתורי טעינה (PayBox / bit) – עיצוב חדש ===== */
  .hint-top{
    text-align:center; font-size:.95rem; opacity:.92; margin:4px 0 10px;
  }
  .pay-actions{
    display:flex; justify-content:center; align-items:flex-start; flex-wrap:wrap;
    gap:16px; margin:6px 0 6px;
  }
  .pay-btn{
    position:relative; display:inline-flex; flex-direction:column; align-items:center; gap:6px;
    padding:10px 12px; background:rgba(255,255,255,.08);
    border:1px solid rgba(255,255,255,.15); border-radius:14px;
    box-shadow:0 2px 8px rgba(0,0,0,.25);
    cursor:pointer; color:#fff; text-decoration:none;
    transition:transform .16s ease, background .16s ease, box-shadow .16s ease;
  }
  .pay-btn:hover{ transform:translateY(-1px); background:rgba(255,255,255,.14); box-shadow:0 6px 16px rgba(0,0,0,.28); }
  .pay-logo{ height:64px; width:auto; border-radius:12px; display:block; filter:brightness(1.03) contrast(1.03); }
  .pay-label{ font-size:.9rem; opacity:.9; }

  /* פידבק "טעינה" קטן */
  .pay-btn.busy::after{ content:""; position:absolute; inset:0; border-radius:inherit; background:rgba(0,0,0,.35); }
  .pay-btn.busy::before{
    content:""; position:absolute; top:50%; left:50%; width:16px; height:16px; margin:-8px 0 0 -8px;
    border:2px solid #fff; border-right-color:transparent; border-radius:50%; animation:spin .65s linear infinite;
  }
  @keyframes spin{ to{ transform:rotate(360deg);} }

  /* ===== מודלים – פייד-אין וטשטוש ===== */
  .modal{
    position:fixed; inset:0; z-index:9999; display:flex; align-items:center; justify-content:center;
    opacity:0; visibility:hidden; pointer-events:none; background:rgba(0,0,0,0);
    transition: opacity .25s ease, visibility .25s ease, background .25s ease; backdrop-filter: blur(0px);
  }
  .modal.show{ opacity:1; visibility:visible; pointer-events:auto; background:rgba(0,0,0,.55); backdrop-filter: blur(4px); }
  .modal-box{
    background:rgba(1,59,51,.96); border:1px solid rgba(255,255,255,.15);
    width:min(380px,92%); color:#fff; text-align:center; padding:18px; border-radius:14px;
    box-shadow:0 10px 30px rgba(0,0,0,.35); transform:translateY(8px) scale(.98); opacity:0;
    transition: transform .28s cubic-bezier(.2,.7,.2,1), opacity .28s ease;
  }
  .modal.show .modal-box{ transform:translateY(0) scale(1); opacity:1; }
  .modal-box h3{ margin:0 0 8px; color:#ffdf91; font-size:1.2rem; }
  .modal-actions{ margin-top:10px; display:flex; justify-content:center; gap:8px; flex-wrap:wrap; }
  .btn{ border:none; border-radius:8px; padding:8px 14px; cursor:pointer; color:#fff; background:var(--btn); }
  .btn:hover{ background:#1b63e8; }
  .btn-ghost{ background:transparent; border:1px solid rgba(255,255,255,.3); }
  .btn-ghost:hover{ background:rgba(255,255,255,.1); }
  .input,.select{
    width:86%; padding:10px; border-radius:10px; border:none; text-align:center; font-size:1rem; outline:none;
    background:rgba(255,255,255,.15); color:#fff; display:block; margin:0 auto 8px;
  }
  .select{ cursor:pointer; }

  @media (max-width:420px){
    .pay-logo{ height:56px; }
    .pay-actions{ gap:12px; }
  }

  /* ===== משיכות – תוספת עיצוב (pill + button) ===== */
  .hours-pill{
    display:inline-block;
    background: rgba(255,255,255,.10);
    border: 1px solid rgba(255,255,255,.18);
    color:#fff;
    padding: 6px 10px;
    border-radius: 999px;
    font-size: .92rem;
    margin: 0 0 10px 0;
  }
  .link-btn{
    display:inline-block;
    text-decoration:none;
    color:#fff;
    background: linear-gradient(135deg,#0ea5e9,#2563eb);
    padding: 10px 14px;
    border-radius: 12px;
    font-weight: 700;
    box-shadow: 0 4px 14px rgba(0,0,0,.28);
    transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
  }
  .link-btn:hover{ transform: translateY(-1px); box-shadow: 0 8px 22px rgba(0,0,0,.34); }
  .link-btn:active{ transform: translateY(0); }
  .link-btn.disabled{
    filter: grayscale(25%) brightness(.9);
    opacity: .85;
  }
</style>
</head>
<body>
  <div class="overlay">
    <h1>הסניף הדיגיטלי</h1>

    <!-- אפליקציה -->
    <div class="section">
     <h2>
  <img src="clubgg-logo-new.png" alt="ClubGG Logo" class="clubgg-logo">
  אפליקציה
</h2>
      <div><b>קוד מועדון:</b> <span class="club-code" id="clubCode">715965</span>
        <button class="copy-btn" onclick="copyText(document.getElementById('clubCode').textContent)">📋 העתק</button>
      </div>
      <div class="store-links">
        <a href="https://apps.apple.com/us/app/clubgg-poker/id1529839330" target="_blank" rel="noopener"><img src="app store.png" class="store-icon" alt="App Store"></a>
        <a href="https://play.google.com/store/apps/details?id=com.nsus.clubgg" target="_blank" rel="noopener"><img src="android.png" class="store-icon" alt="Google Play"></a>
      </div>
    </div>

    <!-- טעינות (עיצוב חדש) -->
    <div class="section">
      <h2>🔋 טעינות</h2>

      <div class="hint-top">לחץ על אחת האופציות לטעינה</div>

      <div class="pay-actions">
        <!-- PayBox: קישור חיצוני -->
        <a class="pay-btn" data-type="paybox" href="https://links.payboxapp.com/9kD9tKtOhWb" target="_blank" rel="noopener" aria-label="טעינה דרך PayBox">
          <img src="PayBox.png" alt="PayBox" class="pay-logo">
          <span class="pay-label">PayBox</span>
        </a>

        <!-- bit: פותח מודאל סכום+כינוי (וואטסאפ לאחר אישור) -->
        <button type="button" class="pay-btn" data-type="bit" onclick="startWhatsappFlow(this)" aria-label="טעינה דרך bit">
          <img src="Bit.png" alt="bit" class="pay-logo">
          <span class="pay-label">bit</span>
        </button>
      </div>

      <div class="tiny-note">בכל טעינה, לשלוח צילום מסך וכינוי.</div>
      <div class="tiny-note"><b>יחס צ׳יפים 1:10</b></div>
    </div>

    <!-- משיכות -->
    <div class="section">
      <h2>💸 משיכות</h2>

      <!-- שעות כ־pill -->
      <div class="hours-pill" id="withdrawHoursPill">
        כל יום שלישי בין <b>18:00</b> ל־<b>00:00</b>
      </div><br>

      <!-- הקישור ככפתור -->
      <a href="https://chat.whatsapp.com/GDw1GilqCab6Un2TspiWBP?mode=wwc"
         target="_blank" rel="noopener"
         id="withdrawGroupLink"
         class="link-btn">
        💬 לקבוצת ה-WhatsApp לביצוע משיכות — לחצו כאן
      </a>
    </div>

    <footer>
      ⚠️ שחקו באחריות
      <div class="footer-sub">🤝 שמרו על הקהילה שלנו – לא מפרסמים קלאבים או משחקים אחרים.</div>
      <div class="footer-sub">אנחנו כאן כדי ליהנות יחד, באווירה טובה ומשפחה אחת</div>
    </footer>
  </div>

  <!-- מודל טעינה: סכום + כינוי -->
  <div id="amountModal" class="modal" aria-hidden="true">
    <div class="modal-box">
      <h3>💰 פרטי טעינה</h3>
      <p>נא להזין סכום טעינה וכינוי באפליקציה:</p>
      <input type="number" id="amountInput" class="input" placeholder="כמה לטעון? (₪)" inputmode="numeric" />
      <input type="text" id="nicknameInput" class="input" placeholder="כינוי באפליקציה" maxlength="30" />
      <div class="modal-actions">
        <button class="btn" onclick="confirmAmount()">שלח</button>
        <button class="btn-ghost" onclick="closeAmountModal()">ביטול</button>
      </div>
    </div>
  </div>

  <!-- מודל חסימה למשיכות מחוץ לשעות -->
  <div id="withdrawBlockedModal" class="modal" aria-hidden="true">
    <div class="modal-box">
      <h3>🕓 לא כרגע</h3>
      <p>המשיכות מתבצעות רק בין 18:00–00:00.<br>המועד הקרוב: <span id="nextWithdrawDate"></span>.</p>
      <div class="modal-actions">
        <button class="btn" onclick="closeWithdrawBlocked()">הבנתי</button>
      </div>
    </div>
  </div>

  <!-- מודל טופס משיכה (4 שדות) -->
  <div id="withdrawFormModal" class="modal" aria-hidden="true">
    <div class="modal-box">
      <h3>בקשת משיכה 💸</h3>
      <p>מלא/י את הפרטים, ונכין הודעה לקבוצה:</p>
      <input id="wdAmount" class="input" type="number" min="1" step="1" placeholder="כמה למשוך? (₪)" inputmode="numeric" />
      <input id="wdKeep" class="input" type="number" min="0" step="1" placeholder="כמה להשאיר? (₪)" inputmode="numeric" />
      <input id="wdNick" class="input" type="text" maxlength="30" placeholder="כינוי באפליקציה" />
      <select id="wdMethod" class="select" aria-label="אופן תשלום">
        <option value="">בחר אופן תשלום</option>
        <option value="ביט">ביט</option>
        <option value="פייבוקס">פייבוקס</option>
      </select>
      <div class="modal-actions">
        <button class="btn" onclick="confirmWithdraw()">אישור</button>
        <button class="btn-ghost" onclick="closeWithdrawForm()">ביטול</button>
      </div>
    </div>
  </div>

<script>
  /* ===== נתונים בסיסיים ===== */
  const PHONES = {
    "מאור":"972546819166",
    "עידו":"972559877777"
  }; // יעדי וואטסאפ

  /* מי מתחיל בחצות בכל יום? 0=יום א', 1=יום ב', ... 6=שבת
     אפשר להפוך ביניהם לפי העדפה.
  */
  const STARTER_FOR_EVEN_DAY = "מאור"; // ימים זוגיים (0,2,4,6) – מאור מתחיל
  const STARTER_FOR_ODD_DAY  = "עידו"; // ימים אי-זוגיים (1,3,5) – עידו מתחיל

  /* ===== דגל אכיפה למשיכות =====
     true  = אכיפה פעילה (רק שלישי 18:00–00:00)
     false = הכל פתוח לצורכי בדיקה
  */
  const ENFORCE_WITHDRAW_RULES = false;

  /* ===== רפרנסים ===== */
  const amountModal = document.getElementById('amountModal');
  const amountInput = document.getElementById('amountInput');
  const nicknameInput = document.getElementById('nicknameInput');
  let pendingPhone = null;

  const withdrawLink = document.getElementById('withdrawGroupLink');
  const withdrawBlockedModal = document.getElementById('withdrawBlockedModal');
  const withdrawFormModal = document.getElementById('withdrawFormModal');
  const nextDateSpan = document.getElementById('nextWithdrawDate');

  const wdAmount = document.getElementById('wdAmount');
  const wdKeep   = document.getElementById('wdKeep');
  const wdNick   = document.getElementById('wdNick');
  const wdMethod = document.getElementById('wdMethod');

  const WITHDRAW_GROUP_URL = "https://chat.whatsapp.com/GDw1GilqCab6Un2TspiWBP?mode=wwc";

  /* ===== זמן מקומי ===== */
  function nowIL(){
    const d=new Date();
    const parts=new Intl.DateTimeFormat("he-IL",{timeZone:"Asia/Jerusalem",hour12:false,hour:"2-digit",minute:"2-digit",weekday:"short"}).formatToParts(d);
    const get=t=>parts.find(x=>x.type===t)?.value;
    const h=+get("hour"), m=+get("minute"), wd=get("weekday");
    const map={"יום א׳":0,"יום ב׳":1,"יום ג׳":2,"יום ד׳":3,"יום ה׳":4,"יום ו׳":5,"יום ש׳":6,"יום שבת":6};
    return { day: map[wd] ?? d.getDay(), minutes: h*60 + m };
  }

  /* מי במשמרת עכשיו? משמרות של 3 שעות, מתחלפות מדי יום בין מאור/עידו */
  function currentShiftOwner(){
    const n = nowIL(); // { day:0..6, minutes:0..1439 }
    const shiftIndex = Math.floor(n.minutes / 180); // 3 שעות = 180 דק' → 8 משמרות ביום

    const dayStarter = (n.day % 2 === 0) ? STARTER_FOR_EVEN_DAY : STARTER_FOR_ODD_DAY;
    const other      = (dayStarter === "מאור") ? "עידו" : "מאור";

    // 0,2,4,6 = מתחיל היום; 1,3,5,7 = השני
    return (shiftIndex % 2 === 0) ? dayStarter : other;
  }

  function isWithdrawWindowOpen(){
    if (!ENFORCE_WITHDRAW_RULES) return true;
    const n = nowIL();
    return n.day===2 && n.minutes>=18*60 && n.minutes<24*60; // שלישי 18:00–00:00
  }

  function nextWithdrawDateString(){
    const n=nowIL(); const now=new Date();
    const TUE=2, start=18*60; let addDays;
    if(n.day===TUE && n.minutes<start) addDays=0;
    else { addDays=(TUE-n.day+7)%7; if(addDays===0) addDays=7; }
    const target=new Date(now.getFullYear(), now.getMonth(), now.getDate()+addDays);
    return new Intl.DateTimeFormat('he-IL',{timeZone:'Asia/Jerusalem',day:'2-digit',month:'2-digit',year:'numeric'}).format(target);
  }

  /* ===== פידבק קצר על כפתורי טעינה ===== */
  function setBusy(el){
    if(!el) return;
    el.classList.add('busy');
    setTimeout(()=> el.classList.remove('busy'), 900);
  }
  document.querySelectorAll('.pay-btn[data-type="paybox"]').forEach(a=>{
    a.addEventListener('click', function(){ setBusy(this); });
  });

  /* ===== טעינות (bit → מודאל) ===== */
  function startWhatsappFlow(btn){
    setBusy(btn?.closest('.pay-btn') || btn);

    // ←— כאן מתבצע הניתוב לפי המשמרת —→
    const owner = currentShiftOwner();
    pendingPhone = PHONES[owner] || PHONES["מאור"];

    amountModal.classList.add('show');
    setTimeout(()=> (amountInput.value ? nicknameInput : amountInput).focus(), 80);
  }
  function closeAmountModal(){ amountModal.classList.remove('show'); }
  function confirmAmount(){
    const rawAmount=(amountInput.value||'').trim();
    const nick=(nicknameInput.value||'').trim();
    const amount=Math.floor(Number(rawAmount));
    if(!rawAmount||!Number.isFinite(amount)||amount<=0){ amountInput.focus(); amountInput.select?.(); return; }
    if(nick.length<2){ nicknameInput.focus(); return; }
    const msg=`היי! רוצה להטעין לסניף הדיגיטלי סכום של ${amount} ₪.\nהכינוי שלי באפליקציה: ${nick}`;
    window.open(`https://api.whatsapp.com/send?phone=${pendingPhone}&text=${encodeURIComponent(msg)}`,"_blank");
    amountInput.value=""; nicknameInput.value=""; closeAmountModal();
  }

  /* ===== משיכות ===== */
  withdrawLink.addEventListener('click', (e)=>{
    if(!isWithdrawWindowOpen()){
      e.preventDefault();
      nextDateSpan.textContent = nextWithdrawDateString();
      withdrawBlockedModal.classList.add('show');
    } else {
      e.preventDefault(); // קודם טופס → אח"כ לקבוצה
      openWithdrawForm();
    }
  });
  function openWithdrawForm(){ withdrawFormModal.classList.add('show'); setTimeout(()=> wdAmount.focus(),80); }
  function closeWithdrawForm(){ withdrawFormModal.classList.remove('show'); }
  function closeWithdrawBlocked(){ withdrawBlockedModal.classList.remove('show'); }

  function confirmWithdraw(){
    const rawA=(wdAmount.value||'').trim();
    const rawK=(wdKeep.value||'').trim();
    const nick=(wdNick.value||'').trim();
    const method=wdMethod.value;
    const amount=Math.floor(Number(rawA));
    const keep=Math.floor(Number(rawK||"0"));
    if(!rawA||!Number.isFinite(amount)||amount<=0){ wdAmount.focus(); wdAmount.select?.(); return; }
    if(keep<0){ wdKeep.focus(); wdKeep.select?.(); return; }
    if(nick.length<2){ wdNick.focus(); return; }
    if(method!=='ביט' && method!=='פייבוקס'){ wdMethod.focus(); return; }

    const text = `בקשת משיכה:\n• סכום למשיכה: ${amount} ₪\n• להשאיר: ${keep} ₪\n• כינוי באפליקציה: ${nick}\n• אופן תשלום: ${method}`;
    window.open(`https://chat.whatsapp.com/GDw1GilqCab6Un2TspiWBP?mode=wwc&text=${encodeURIComponent(text)}`,"_blank");

    wdAmount.value=""; wdKeep.value=""; wdNick.value=""; wdMethod.value="";
    closeWithdrawForm();
  }

  // צובע את מצב הכפתור (enabled/disabled) לפי השעה/יום
  function paintWithdrawButtonState(){
    const btn = document.getElementById('withdrawGroupLink');
    if(!btn) return;
    if (isWithdrawWindowOpen()) btn.classList.remove('disabled');
    else                        btn.classList.add('disabled');
  }
  paintWithdrawButtonState();
  setInterval(paintWithdrawButtonState, 60*1000);

  /* ===== כלי ===== */
  function copyText(t){ navigator.clipboard.writeText(t); alert("הועתק!"); }
</script>
</body>
</html>

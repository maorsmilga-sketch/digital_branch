<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>הסניף הדיגיטלי</title>
<style>
:root {
  --fg:#f7f7f2; --glass:rgba(0,0,0,.55); --glass-brd:rgba(255,255,255,.08);
  --accent:#22d3ee; --btn:#2b7bff;
}
body {
  font-family:'Heebo',system-ui;
  background:url('background.png') center/cover no-repeat fixed;
  color:var(--fg); margin:0; text-align:center;
}
.overlay {
  width:min(640px,94%); margin:110px auto 20px; padding:18px 14px 20px;
  background:var(--glass); border:1px solid var(--glass-brd);
  border-radius:18px; box-shadow:0 0 20px rgba(0,0,0,.4);
}
h1 { margin:6px 0 8px; font-size:1.95rem; line-height:1.1; }
.section {
  background:rgba(0,0,0,.53); border:1px solid var(--glass-brd);
  border-radius:12px; padding:12px; margin:12px auto 0; text-align:right;
}
a { color:var(--accent); font-weight:600; text-decoration:underline; }
.club-code { font-size:1.9rem; font-weight:800; }
.copy-btn { background:var(--btn); color:#fff; border:none; border-radius:6px; padding:6px 10px; cursor:pointer; }
.copy-btn:hover { background:#1b63e8; }
.store-links { display:flex; justify-content:center; gap:10px; margin-top:6px; }
.store-links a {
  background:rgba(255,255,255,.1); padding:4px 6px; border-radius:8px; transition:.2s;
  display:flex; align-items:center; gap:6px; 
}
.store-links a:hover {
  transform:scale(1.05); background:rgba(255,255,255,.18);
}
.store-icon { width:65px; opacity:.95; }
.tiny-note { font-size:.86em; opacity:.92; margin-top:6px; text-align:center; }
.whatsapp-link { margin-top:12px; font-weight:700; font-size:1rem; }
.whatsapp-link a {
  color:#25D366; text-decoration:none; font-weight:700; border:1px solid #25D366;
  padding:8px 12px; border-radius:14px; display:inline-flex; align-items:center; gap:8px;
  transition:background-color 0.3s, color 0.3s;
}
.whatsapp-link a:hover {
  background:#25D366; color:#fff;
}
footer {
  margin-top:14px; font-weight:700; font-size:1.05rem; color:#ffdf91;
}
.footer-sub {
  font-weight:500; font-size:.83rem; color:#ffe9b6; margin-top:6px;
}
.club-row {
  display:flex; align-items:center; justify-content:center; gap:10px; flex-wrap:wrap; margin-top:6px;
}
.club-code-label {
  font-weight:700; color:#e5e5e5; font-size:1rem;
}
.club-code-badge {
  font-size:2rem; font-weight:900; color:#222; background:linear-gradient(135deg,#f9f9f9,#cfcfcf);
  border-radius:10px; padding:6px 16px; box-shadow:0 3px 10px rgba(0,0,0,.25); letter-spacing:2px;
}
.copy-btn {
  height:36px; padding:0 12px; border-radius:10px; font-weight:700;
}
.pay-actions {
  display:flex; justify-content:center; align-items:stretch; gap:16px; flex-wrap:wrap; margin:10px 0 8px;
}
.pay-btn {
  position:relative; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px;
  width:160px; min-height:120px; padding:12px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.15);
  border-radius:14px; box-shadow:0 2px 8px rgba(0,0,0,.25); cursor:pointer; color:#fff; text-decoration:none;
  transition:transform .16s ease, background .16s ease, box-shadow .16s ease; 
}
.pay-btn:hover {
  transform:translateY(-1px); background:rgba(255,255,255,.14); box-shadow:0 6px 16px rgba(0,0,0,.28);
}
.pay-logo {
  height:64px; width:auto; border-radius:12px; display:block; filter:brightness(1.03) contrast(1.03);
}
.pay-label {
  font-size:.95rem; opacity:.95; font-weight:600;
}
@media (max-width:420px) {
  .pay-logo{ height:56px; }
  .pay-btn{ width:140px; min-height:110px; }
}
.shift-indicator {
  position:fixed; top:12px; left:12px; z-index:9999; background:rgba(0,0,0,.55);
  border:1px solid rgba(255,255,255,.15); border-radius:12px; padding:6px; 
  box-shadow:0 3px 10px rgba(0,0,0,.3); cursor:pointer; transition:transform .15s ease, background .15s ease;
}
.shift-indicator:hover {
  transform:scale(1.05); background:rgba(0,0,0,.65);
}
.shift-indicator img {
  width:42px; height:42px; border-radius:10px; display:block;
}
.modal {
  position:fixed; inset:0; z-index:9998; display:flex; align-items:center; justify-content:center;
  opacity:0; visibility:hidden; pointer-events:none; background:rgba(0,0,0,0);
  transition:opacity .25s ease, visibility .25s ease, background .25s ease;
}
.modal.show {
  opacity:1; visibility:visible; pointer-events:auto; background:rgba(0,0,0,.55);
}
.modal-box {
  background:rgba(1,59,51,.96); border:1px solid rgba(255,255,255,.15);
  width:min(420px,92%); color:#fff; text-align:right; padding:18px; border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.35);
}
.modal-box h3 {
  margin:0 0 12px; color:#ffdf91; font-size:1.2rem;
}
.modal-actions {
  margin-top:12px; display:flex; justify-content:flex-start; gap:8px;
}
.btn {
  border:none; border-radius:8px; padding:8px 14px; cursor:pointer; color:#fff; background:var(--btn);
}
.btn:hover {
  background:#1b63e8;
}
.btn-ghost {
  background:transparent; border:1px solid rgba(255,255,255,.3);
}
.btn-ghost:hover {
  background:rgba(255,255,255,.1);
}
.input {
  background:rgba(255,255,255,.1); border:1px solid rgba(255,255,255,.25);
  color:#fff; border-radius:10px; padding:10px; font-size:1rem; outline:none;
}
/* עיצוב מיוחד למודאל האישור של Bit עם תמונה */
#bitConfirmModal .modal-box {
  align-items: center;
}
.bit-helper-image {
  width: 92%;
  max-width: 340px;
  border-radius: 13px;
  box-shadow: 0 4px 18px rgba(34,211,238,0.13);
  border: 1.5px solid #25d3ee;
  margin-bottom: 8px;
  margin-top: 2px;
}
</style>
</head>
<body>

<!-- כפתור משמרת -->
<div class="shift-indicator" onclick="openShiftModal()" title="מי במשמרת עכשיו?">
<img src="shift.png" alt="משמרת">
</div>

<!-- מודאל משמרת -->
<div id="shiftModal" class="modal" aria-hidden="true">
<div class="modal-box">
  <h3>🕓 מי במשמרת עכשיו?</h3>
  <p id="shiftText">טוען...</p>
  <div class="modal-actions"><button class="btn" onclick="closeShiftModal()">הבנתי</button></div>
</div>
</div>

<!-- מודאל Bit -->
<div id="bitModal" class="modal" aria-hidden="true">
<div class="modal-box">
  <h3>bit — תשלום למפעיל</h3>
  <p>מספר הטלפון לביצוע העברה:</p>
  <p id="bitPhone" style="font-size:1.3rem; font-weight:bold; margin-bottom:10px;"></p>
  <div class="modal-actions" style="flex-direction: column; gap: 10px; margin-top: 15px;">
    <button class="btn" id="copyAndOpenBit">📋 העתק מספר ופתח Bit</button>
    <button class="btn" id="closeBitModalBtn">סגור</button>
  </div>
</div>
</div>

<!-- מודאל אישור Bit (כולל Helper.jpg) -->
<div id="bitConfirmModal" class="modal" aria-hidden="true">
<div class="modal-box">
  <h3>המספר הטלפון הועתק</h3>
  
<p style="text-align:center; line-height:1.6;" dir="rtl">
  <b>המספר הועתק!</b><br>
  בצעו העברה ב-Bit דרך<br>
  <b>"העברה לפי מספר נייד"</b><br>
  (כמו בתמונה למטה)<br>
  הדביקו את המספר, צלמו מסך<br>
  ושלחו ב-
  <a href="https://chat.whatsapp.com/GebftOLJuNB8h2w2F8Vxkx?mode=wwc" 
     target="_blank" 
     rel="noopener noreferrer"
     style="color:#25D366; font-weight:bold; text-decoration:none;">
     קבוצת ה-WhatsApp של הסניף הדיגיטלי 💬
  </a><br>
  בצירוף הכינוי שלכם.
</p>
  
  <img src="Helper.jpg" alt="הדגמת פעולה Bit" class="bit-helper-image">
  <div class="modal-actions" style="justify-content:center;">
    <button class="btn" id="openBitAppBtn">פתח את אפליקציית Bit</button>
    <button class="btn-ghost" id="closeBitConfirmBtn">סגור</button>
  </div>
</div>
</div>

<!-- מודאל PayBox -->
<div id="payboxModal" class="modal" aria-hidden="true">
<div class="modal-box">
  <h3>PayBox — תשלום</h3>
  
  <p style="text-align:center; line-height:1.6;" dir="rtl">
  <b>לאחר התשלום ב-PayBox,</b><br>
  צלמו מסך של ההעברה ושלחו אותו<br>
  ב-WhatsApp של הסניף הדיגיטלי עם הכינוי.
</p>
  
  <div class="modal-actions">
    <button class="btn" onclick="goToPayBox()">המשך לטעינה ב PayBox</button>
    <button class="btn" onclick="closePayboxModal()">ביטול</button>
  </div>
</div>
</div>

<!-- מודאל משיכות WhatsApp -->
<div id="withdrawWhatsAppModal" class="modal" aria-hidden="true">
<div class="modal-box">
  <h3>שליחת בקשת משיכה</h3>
  <p>שלח בקבוצת המשיכות הסניף הדיגיטלי כינוי וסכום למשיכה.</p>
  <div class="modal-actions">
    <button class="btn" onclick="openWithdrawWhatsAppGroup()">פתח את קבוצת המשיכות</button>
    <button class="btn-ghost" onclick="closeWithdrawWhatsAppModal()">סגור</button>
  </div>
</div>
</div>

<div class="overlay">
<h1>הסניף הדיגיטלי</h1>

<div class="section">
  <h2>📱 אפליקציה</h2>
  <div class="club-row">
    <span class="club-code-label">קוד מועדון:</span>
    <span class="club-code-badge" id="clubCode">715965</span>
    <button class="copy-btn" onclick="copyText(document.getElementById('clubCode').textContent)">📋 העתק</button>
  </div>
  <div class="store-links">
    <a href="https://apps.apple.com/us/app/clubgg-poker/id1529839330" target="_blank"><img src="app store.png" class="store-icon" alt="App Store"></a>
    <a href="https://play.google.com/store/apps/details?id=com.nsus.clubgg" target="_blank"><img src="android.png" class="store-icon" alt="Google Play"></a>
  </div>
  <div class="whatsapp-link">
<a href="https://chat.whatsapp.com/GebftOLJuNB8h2w2F8Vxkx?mode=wwc"
   target="_blank"
   rel="noopener noreferrer"
   style="color:#25D366; font-weight:bold; text-decoration:none;">
  💬 לקבוצת ה-WhatsApp של הסניף הדיגיטלי
</a>
  </div>
</div>

<div class="section topup-section">
  <h2>🔋 טעינות</h2>
  <div class="hint-top">לחץ על אחת האופציות לטעינה</div>
  <div class="tiny-note"><b>שימו ❤️ טעינות מתבצעות כל יום בין 18:00 ל־00:00</b></div>
  <div class="pay-actions">
    <a class="pay-btn" data-type="paybox" href="https://links.payboxapp.com/9kD9tKtOhWb" target="_blank" onclick="openPayboxModal(event)">
      <img src="PayBox.png" class="pay-logo" alt="PayBox"><span class="pay-label">PayBox</span>
    </a>
    <button class="pay-btn" id="bitBtn" data-type="bit">
      <img src="Bit.png" class="pay-logo" alt="bit"><span class="pay-label">bit</span>
    </button>
  </div>
  <div class="tiny-note">בכל טעינה, לשלוח צילום מסך וכינוי.</div>
  <div class="tiny-note"><b>יחס צ׳יפים 1:10</b></div>
</div>

<div class="section">
  <h2>💸 משיכות</h2>
  <div class="hours-pill">כל יום שלישי בין <b>18:00</b> ל־<b>00:00</b></div>
  <a id="withdrawLink" href="https://chat.whatsapp.com/GDw1GilqCab6Un2TspiWBP?mode=wwc" target="_blank" class="link-btn">💬 לקבוצת ה-WhatsApp לביצוע משיכות</a>
</div>

<footer>
  ⚠️ שחקו באחריות
  <div class="footer-sub">🤝 שמרו על הקהילה שלנו – לא מפרסמים קלאבים או משחקים אחרים.</div>
  <div class="footer-sub">אנחנו כאן כדי ליהנות יחד, באווירה טובה </div>
</footer>
</div>

<script>
function copyText(t){ navigator.clipboard?.writeText(t).catch(()=>{}); }

const PHONE_MAOR = "0546819166";
const PHONE_IDO  = "0559877777";

function nowIL(){
  const d = new Date();
  const fmt = new Intl.DateTimeFormat('he-IL',{timeZone:'Asia/Jerusalem', hour12:false, hour:'2-digit', minute:'2-digit', weekday:'long'}).formatToParts(d);
  const get=t=>fmt.find(x=>x.type===t)?.value;
  const h=+get('hour'), m=+get('minute');
  const wd=(get('weekday')||'').trim();
  const mapLong={"יום ראשון":0,"יום שני":1,"יום שלישי":2,"יום רביעי":3,"יום חמישי":4,"יום שישי":5,"שבת":6,"יום שבת":6};
  const day=(wd in mapLong)?mapLong[wd]:d.getDay();
  return {day, minutes:h*60+m};
}
const STARTER_FOR_EVEN_DAY = 'מאור';
const STARTER_FOR_ODD_DAY  = 'עידו';
function currentShiftOwner(){
  const n = nowIL();
  const shiftIndex = Math.floor(n.minutes/180);
  const dayStarter = (n.day%2===0)?STARTER_FOR_EVEN_DAY:STARTER_FOR_ODD_DAY;
  const other = (dayStarter==='מאור')?'עידו':'מאור';
  return (shiftIndex%2===0)?dayStarter:other;
}

function openShiftModal(){
  const name = currentShiftOwner();
  document.getElementById('shiftText').textContent = `במשמרת: ${name}`;
  document.getElementById('shiftModal').classList.add('show');
}
function closeShiftModal(){ document.getElementById('shiftModal').classList.remove('show'); }

function openBitModal(){
  const name = currentShiftOwner();
  const phone = (name==='מאור') ? PHONE_MAOR : PHONE_IDO;
  document.getElementById('bitPhone').textContent = phone;
  document.getElementById('bitModal').classList.add('show');
}

function closeBitModal(){ document.getElementById('bitModal').classList.remove('show'); }

function copyAndOpenBitConfirm(){
  const phone = document.getElementById('bitPhone').textContent;
  navigator.clipboard.writeText(phone).then(() => {
    closeBitModal();
    document.getElementById('bitConfirmModal').classList.add('show');
  });
}

function closeBitConfirmModal(){
  document.getElementById('bitConfirmModal').classList.remove('show');
}

function openBitApp(){
  window.open('bit://', '_blank');
}

function openPayboxModal(event){
  event.preventDefault();
  document.getElementById('payboxModal').classList.add('show');
}
function closePayboxModal(){
  document.getElementById('payboxModal').classList.remove('show');
}
function goToPayBox(){
  window.open('https://links.payboxapp.com/9kD9tKtOhWb', '_blank');
  closePayboxModal();
}

const withdrawLink = document.getElementById('withdrawLink');
const withdrawWhatsAppModal = document.getElementById('withdrawWhatsAppModal');
function openWithdrawWhatsAppModal(event){
  event.preventDefault();
  withdrawWhatsAppModal.classList.add('show');
}
function closeWithdrawWhatsAppModal(){
  withdrawWhatsAppModal.classList.remove('show');
}
function openWithdrawWhatsAppGroup(){
  window.open(withdrawLink.href, '_blank');
  closeWithdrawWhatsAppModal();
}
withdrawLink.addEventListener('click', openWithdrawWhatsAppModal);

document.addEventListener('DOMContentLoaded', function () {
  document.getElementById('bitBtn').addEventListener('click', openBitModal);
  document.getElementById('copyAndOpenBit').addEventListener('click', copyAndOpenBitConfirm);
  document.getElementById('closeBitModalBtn').addEventListener('click', closeBitModal);
  document.getElementById('closeBitConfirmBtn').addEventListener('click', closeBitConfirmModal);
  document.getElementById('openBitAppBtn').addEventListener('click', openBitApp);
});
</script>

<!-- 🧩 Drop‑in: כפתור החלפת שפה (עברית ⇄ אנגלית/רוסית) ללא שינוי עיצוב/פונקציות קיימות -->
<script>
(function(){
  "use strict";
  /**
   * עקרונות:
   * - לא נוגעים בקוד/עיצוב קיים, לא משנים dir/lang.
   * - ברירת מחדל: עברית.
   * - כפתור צף ב‑Shadow DOM כדי לא לזהם CSS.
   * - מתרגם טקסטים גם שמופיעים מאוחר יותר (מודאלים וכו') באמצעות MutationObserver.
   * - תרגום מבוסס מילון של מחרוזות מדויקות מתוך הדף הזה. ניתן להרחיב בלחיצה.
   */

  // ===== 1) מילון מחרוזות =====
  const DICT = {
    // כותרות כלליות
    "הסניף הדיגיטלי": { en: "The Digital Branch", ru: "Цифровое отделение" },
    "📱 אפליקציה": { en: "📱 App", ru: "📱 Приложение" },
    "קוד מועדון:": { en: "Club Code:", ru: "Код клуба:" },
    "📋 העתק": { en: "📋 Copy", ru: "📋 Копировать" },

    // טעינות
    "🔋 טעינות": { en: "🔋 Top‑ups", ru: "🔋 Пополнения" },
    "לחץ על אחת האופציות לטעינה": { en: "Click one of the top‑up options", ru: "Выберите один из вариантов пополнения" },
    "שימו ❤️ טעינות מתבצעות כל יום בין 18:00 ל־00:00": { en: "Note ❤️ Top‑ups are processed daily between 18:00–00:00", ru: "Важно ❤️ Пополнения обрабатываются ежедневно с 18:00 до 00:00" },
    "בכל טעינה, לשלוח צילום מסך וכינוי.": { en: "For every top‑up, send a screenshot with your nickname.", ru: "Для каждого пополнения отправьте скриншот с вашим ником." },
    "יחס צ׳יפים 1:10": { en: "Chip rate 1:10", ru: "Курс фишек 1:10" },

    // משיכות
    "💸 משיכות": { en: "💸 Withdrawals", ru: "💸 Вывод средств" },
    "כל יום שלישי בין 18:00 ל־00:00": { en: "Every Tuesday between 18:00–00:00", ru: "Каждый вторник с 18:00 до 00:00" },
    "💬 לקבוצת ה-WhatsApp לביצוע משיכות": { en: "💬 WhatsApp group for withdrawals", ru: "💬 Группа WhatsApp для вывода" },

    // פוטר
    "⚠️ שחקו באחריות": { en: "⚠️ Play responsibly", ru: "⚠️ Играйте ответственно" },
    "🤝 שמרו על הקהילה שלנו – לא מפרסמים קלאבים או משחקים אחרים.": { en: "🤝 Keep our community clean – no advertising other clubs or games.", ru: "🤝 Поддерживайте наше сообщество – без рекламы других клубов и игр." },
    "אנחנו כאן כדי ליהנות יחד, באווירה טובה ": { en: "We’re here to have fun together, in a good vibe ", ru: "Мы здесь, чтобы вместе получать удовольствие, в хорошей атмосфере " },

    // מודאל משמרת
    "🕓 מי במשמרת עכשיו?": { en: "🕓 Who is on shift now?", ru: "🕓 Кто сейчас на смене?" },
    "טוען...": { en: "Loading...", ru: "Загрузка..." },
    "הבנתי": { en: "Got it", ru: "Понял(а)" },

    // מודאל Bit
    "bit — תשלום למפעיל": { en: "bit — Payment to operator", ru: "bit — Платёж оператору" },
    "מספר הטלפון לביצוע העברה:": { en: "Phone number for transfer:", ru: "Номер телефона для перевода:" },
    "📋 העתק מספר ופתח Bit": { en: "📋 Copy number & open Bit", ru: "📋 Копировать номер и открыть Bit" },
    "סגור": { en: "Close", ru: "Закрыть" },

    // מודאל אישור Bit
    "המספר הטלפון הועתק": { en: "Phone number copied", ru: "Номер телефона скопирован" },
    "המספר הועתק!": { en: "Number copied!", ru: "Номер скопирован!" },
    "בצעו העברה ב-Bit דרך": { en: "Make a transfer in Bit via", ru: "Сделайте перевод в Bit через" },
    "\"העברה לפי מספר נייד\"": { en: '"Transfer by mobile number"', ru: '"Перевод по номеру телефона"' },
    "(כמו בתמונה למטה)": { en: "(as in the image below)", ru: "(как на изображении ниже)" },
    "הדביקו את המספר, צלמו מסך": { en: "Paste the number, take a screenshot", ru: "Вставьте номер, сделайте скриншот" },
    "ושלחו ב-": { en: "and send in ", ru: "и отправьте в " },
    "קבוצת ה-WhatsApp של הסניף הדיגיטלי 💬": { en: "the Digital Branch WhatsApp group 💬", ru: "группу WhatsApp цифрового отделения 💬" },
    "בצירוף הכינוי שלכם.": { en: "with your nickname.", ru: "с вашим ником." },
    "פתח את אפליקציית Bit": { en: "Open Bit app", ru: "Открыть приложение Bit" },

    // מודאל PayBox
    "PayBox — תשלום": { en: "PayBox — Payment", ru: "PayBox — Платёж" },
    "לאחר התשלום ב-PayBox,": { en: "After paying via PayBox,", ru: "После оплаты через PayBox," },
    "צלמו מסך של ההעברה ושלחו אותו": { en: "take a screenshot of the transfer and send it", ru: "сделайте скриншот перевода и отправьте его" },
    "ב-WhatsApp של הסניף הדיגיטלי עם הכינוי.": { en: "in the Digital Branch WhatsApp with your nickname.", ru: "в WhatsApp цифрового отделения с вашим ником." },
    "המשך לטעינה ב PayBox": { en: "Continue to PayBox top‑up", ru: "Перейти к пополнению PayBox" },
    "ביטול": { en: "Cancel", ru: "Отмена" },

    // מודאל משיכות WhatsApp
    "שליחת בקשת משיכה": { en: "Send withdrawal request", ru: "Отправка запроса на вывод" },
    "שלח בקבוצת המשיכות הסניף הדיגיטלי כינוי וסכום למשיכה.": { en: "In the withdrawals group, send your nickname and amount.", ru: "В группе вывода отправьте ваш ник и сумму." },
    "פתח את קבוצת המשיכות": { en: "Open withdrawals group", ru: "Открыть группу для вывода" },

    // כפתורי שירות
    "לקבוצת ה-WhatsApp של הסניף הדיגיטלי": { en: "To the Digital Branch WhatsApp group", ru: "В группу WhatsApp цифрового отделения" },
    "מי במשמרת עכשיו?": { en: "Who is on shift now?", ru: "Кто сейчас на смене?" }
  };

  // ===== 2) כלי עזר =====
  const LSK = "_ui_lang_pref"; // localStorage key
  const DEFAULT_LANG = "he"; // דרישת דיפולט: עברית

  function getPrefLang(){ try { return localStorage.getItem(LSK) || DEFAULT_LANG; } catch(e){ return DEFAULT_LANG; } }
  function setPrefLang(lang){ try { localStorage.setItem(LSK, lang); } catch(e){} }

  const ORIGINALS = new WeakMap();
  function tFor(str, lang){ const e = DICT[str && str.trim()]; return e ? (e[lang] || null) : null; }

  function translateTextNode(txt, lang){
    const original = ORIGINALS.get(txt) ?? txt.nodeValue;
    if (!ORIGINALS.has(txt)) ORIGINALS.set(txt, original);
    const rep = tFor(original, lang);
    if (rep) txt.nodeValue = rep; // אם אין תרגום – השאר כפי שהוא
  }

  function walkAndTranslate(root, lang){
    const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, {
      acceptNode: function(n){
        if (!n.nodeValue || !n.nodeValue.trim()) return NodeFilter.FILTER_REJECT;
        const el = n.parentElement;
        if (!el || el.closest('language-toggle-widget,[data-no-i18n]')) return NodeFilter.FILTER_REJECT;
        return NodeFilter.FILTER_ACCEPT;
      }
    });
    let node; while ((node = walker.nextNode())) translateTextNode(node, lang);
  }

  function applyLanguage(lang){ walkAndTranslate(document.body, lang); }

  // ===== 3) צפיה בשינויים (מודאלים וכו') =====
  const OBS = new MutationObserver(muts => {
    const lang = getPrefLang();
    for (const m of muts){
      if (m.type === 'characterData') translateTextNode(m.target, lang);
      if (m.type === 'childList' && m.addedNodes){
        m.addedNodes.forEach(n => {
          if (n.nodeType === 1) walkAndTranslate(n, lang);
          else if (n.nodeType === 3) translateTextNode(n, lang);
        });
      }
    }
  });
  function startObserve(){
    OBS.observe(document.body, { childList:true, subtree:true, characterData:true });
  }

  // ===== 4) ווידג'ט צף (Shadow DOM) =====
  function createWidget(){
    const host = document.createElement('language-toggle-widget');
    host.style.position = 'fixed';
    host.style.insetInlineEnd = '14px';
    host.style.bottom = '14px';
    host.style.zIndex = '2147483647';
    document.documentElement.appendChild(host);

    const root = host.attachShadow({mode:'open'});
    const style = document.createElement('style');
    style.textContent = `
      *{box-sizing:border-box}
      .wrap{display:flex;gap:8px;align-items:center;font:13px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial}
      .tag{padding:2px 6px;border:1px solid #eee;border-radius:6px;color:#222;background:#fff}
      .sel{border:1px solid #d0d0d0;padding:6px 8px;border-radius:8px;background:#fff}
      .btn{border:1px solid #d0d0d0;padding:6px 10px;border-radius:8px;background:#fff;cursor:pointer}
      .btn:hover{background:#f5f5f5}
    `;

    const wrap = document.createElement('div'); wrap.className = 'wrap';
    const label = document.createElement('span'); label.className = 'tag'; label.textContent = 'שפה';
    const select = document.createElement('select'); select.className = 'sel';
    select.innerHTML = `
      <option value="he">עברית (דיפולט)</option>
      <option value="en">English</option>
      <option value="ru">Русский</option>
    `;
    const btn = document.createElement('button'); btn.className = 'btn'; btn.type='button'; btn.textContent = 'החלף';

    wrap.append(label, select, btn); root.append(style, wrap);

    // מצב התחלתי
    select.value = getPrefLang();
    btn.addEventListener('click', ()=>{ const lang = select.value; setPrefLang(lang); applyLanguage(lang); });
  }

  // ===== 5) אתחול =====
  if (!localStorage.getItem(LSK)) setPrefLang(DEFAULT_LANG);
  function init(){ createWidget(); applyLanguage(getPrefLang()); startObserve(); }
  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init); else init();
})();
</script>

<!-- טיפ: ניתן לסמן אזור שלא יתורגם באמצעות data-no-i18n על אלמנט עוטף. -->



  
</body>
</html>

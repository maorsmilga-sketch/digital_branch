<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>×”×¡× ×™×£ ×”×“×™×’×™×˜×œ×™</title>
<style>
:root{
  --fg:#f7f7f2; --glass:rgba(0,0,0,.55); --glass-brd:rgba(255,255,255,.08);
  --accent:#22d3ee; --btn:#2b7bff;
}
body{
  font-family:'Heebo',system-ui;
  background:url('background.png') center/cover no-repeat fixed;
  color:var(--fg); margin:0; text-align:center;
}
.overlay{
  width:min(640px,94%); margin:110px auto 20px; padding:18px 14px 20px;
  background:var(--glass); border:1px solid var(--glass-brd);
  border-radius:18px; box-shadow:0 0 20px rgba(0,0,0,.4);
}
h1{ margin:6px 0 8px; font-size:1.95rem; line-height:1.1; }

.section{
  background:rgba(0,0,0,.53); border:1px solid var(--glass-brd);
  border-radius:12px; padding:12px; margin:12px auto 0; text-align:right;
}
a{ color:var(--accent); font-weight:600; text-decoration:underline; }

.club-code{ font-size:1.9rem; font-weight:800; }
.copy-btn{ background:var(--btn); color:#fff; border:none; border-radius:6px; padding:6px 10px; cursor:pointer; }
.copy-btn:hover{ background:#1b63e8; }

.store-links{ display:flex; justify-content:center; gap:10px; margin-top:6px; }
.store-links a{ background:rgba(255,255,255,.1); padding:4px 6px; border-radius:8px; transition:.2s; }
.store-links a:hover{ transform:scale(1.05); background:rgba(255,255,255,.18); }
.store-icon{ width:65px; opacity:.95; }

.tiny-note{ font-size:.86em; opacity:.92; margin-top:6px; text-align:center; }
footer{ margin-top:14px; font-weight:700; font-size:1.05rem; color:#ffdf91; }
.footer-sub{ font-weight:500; font-size:.83rem; color:#ffe9b6; margin-top:6px; }

/* === ×›×•×ª×¨×ª ××¤×œ×™×§×¦×™×” (×™×™×©×•×¨ ×œ×™××™×Ÿ ×›××• ×©××¨ ×”×¡×¢×™×¤×™×) === */
.app-title{ display:flex; align-items:center; justify-content:flex-end; gap:8px; margin:0 0 8px 0; }
.app-title .title-text{ margin:0; font-size:1.3rem; color:var(--fg); line-height:1; }
.app-title .app-logo{ height:1.3em; width:auto; border-radius:6px; object-fit:contain; }

/* === ×§×•×“ ××•×¢×“×•×Ÿ === */
.club-row{ display:flex; align-items:center; justify-content:center; gap:10px; flex-wrap:wrap; margin-top:6px; }
.club-code-label{ font-weight:700; color:#e5e5e5; font-size:1rem; }
.club-code-badge{ font-size:2rem; font-weight:900; color:#222; background:linear-gradient(135deg,#f9f9f9,#cfcfcf); border-radius:10px; padding:6px 16px; box-shadow:0 3px 10px rgba(0,0,0,.25); letter-spacing:2px; }
.copy-btn{ height:36px; padding:0 12px; border-radius:10px; font-weight:700; }

/* ===== ×˜×¢×™× ×•×ª ===== */
.pay-actions{ display:flex; justify-content:center; align-items:stretch; gap:16px; flex-wrap:wrap; margin:10px 0 8px; }
.pay-btn{ position:relative; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; width:160px; min-height:120px; padding:12px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.15); border-radius:14px; box-shadow:0 2px 8px rgba(0,0,0,.25); cursor:pointer; color:#fff; text-decoration:none; transition:transform .16s ease, background .16s ease, box-shadow .16s ease; }
.pay-btn:hover{ transform:translateY(-1px); background:rgba(255,255,255,.14); box-shadow:0 6px 16px rgba(0,0,0,.28); }
.pay-logo{ height:64px; width:auto; border-radius:12px; display:block; filter:brightness(1.03) contrast(1.03); }
.pay-label{ font-size:.95rem; opacity:.95; font-weight:600; }
@media (max-width:420px){ .pay-logo{ height:56px; } .pay-btn{ width:140px; min-height:110px; } }

/* ===== ×›×¤×ª×•×¨ ××©××¨×ª ×¦×£ ===== */
.shift-indicator{ position:fixed; top:12px; left:12px; z-index:9999; background:rgba(0,0,0,.55); border:1px solid rgba(255,255,255,.15); border-radius:12px; padding:6px; box-shadow:0 3px 10px rgba(0,0,0,.3); cursor:pointer; transition:transform .15s ease, background .15s ease; }
.shift-indicator:hover{ transform:scale(1.05); background:rgba(0,0,0,.65); }
.shift-indicator img{ width:42px; height:42px; border-radius:10px; display:block; }

/* ===== ××•×“××œ ×›×œ×œ×™ ===== */
.modal{ position:fixed; inset:0; z-index:9998; display:flex; align-items:center; justify-content:center; opacity:0; visibility:hidden; pointer-events:none; background:rgba(0,0,0,0); transition:opacity .25s ease, visibility .25s ease, background .25s ease; }
.modal.show{ opacity:1; visibility:visible; pointer-events:auto; background:rgba(0,0,0,.55); }
.modal-box{ background:rgba(1,59,51,.96); border:1px solid rgba(255,255,255,.15); width:min(420px,92%); color:#fff; text-align:right; padding:18px; border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.35); }
.modal-box h3{ margin:0 0 12px; color:#ffdf91; font-size:1.2rem; }
.modal-actions{ margin-top:12px; display:flex; justify-content:flex-start; gap:8px; }
.btn{ border:none; border-radius:8px; padding:8px 14px; cursor:pointer; color:#fff; background:var(--btn); }
.btn:hover{ background:#1b63e8; }
.btn-ghost{ background:transparent; border:1px solid rgba(255,255,255,.3); }
.btn-ghost:hover{ background:rgba(255,255,255,.1); }

/* ===== ×©×“×•×ª ××•×“××œ ===== */
.field{ display:flex; flex-direction:column; gap:6px; margin:10px 0; }
.label{ font-size:.95rem; opacity:.95; }
.input{ background:rgba(255,255,255,.1); border:1px solid rgba(255,255,255,.25); color:#fff; border-radius:10px; padding:10px; font-size:1rem; outline:none; }
.input:focus{ border-color:var(--accent); box-shadow:0 0 0 3px rgba(34,211,238,.25); }
.select{ background:rgba(255,255,255,.1); border:1px solid rgba(255,255,255,.25); color:#fff; border-radius:10px; padding:10px; font-size:1rem; }
.hint{ font-size:.82rem; opacity:.9; }
.error{ font-size:.86rem; color:#ffd1d1; display:none; }
.error.show{ display:block; }
</style>
</head>
<body>

<!-- ×›×¤×ª×•×¨ ××©××¨×ª -->
<div class="shift-indicator" onclick="openShiftModal()" title="××™ ×‘××©××¨×ª ×¢×›×©×™×•?">
  <img src="shift.png" alt="××©××¨×ª">
</div>

<!-- ××•×“××œ ××©××¨×ª -->
<div id="shiftModal" class="modal" aria-hidden="true">
  <div class="modal-box">
    <h3>ğŸ•“ ××™ ×‘××©××¨×ª ×¢×›×©×™×•?</h3>
    <p id="shiftText">×˜×•×¢×Ÿ...</p>
    <div class="modal-actions">
      <button class="btn" onclick="closeShiftModal()">×”×‘× ×ª×™</button>
    </div>
  </div>
</div>

<!-- ××•×“××œ bit: ×§×œ×™×˜×ª ×›×™× ×•×™ + ×¡×›×•× -->
<div id="bitModal" class="modal" aria-hidden="true">
  <div class="modal-box">
    <h3>bit â€” ×‘×§×©×ª ×˜×¢×™× ×”</h3>
    <form id="bitForm">
      <div class="field">
        <label class="label" for="nickname">×›×™× ×•×™ (×©× ×‘××¤×œ×™×§×¦×™×”)</label>
        <input class="input" id="nickname" name="nickname" placeholder="ClubGG name" autocomplete="off" required />
      </div>
      <div class="field">
        <label class="label" for="amount">×¡×›×•× (â‚ª)</label>
        <input class="input" id="amount" name="amount" type="number" min="1" step="1" inputmode="numeric" placeholder="×œ××©×œ: 50" required />
        <div id="bitError" class="error">×‘×“×•×§ ×©×”×›×™× ×•×™ ××•×œ× ×•×”×¡×›×•× ×’×“×•×œ ×Ö¾0.</div>
      </div>

      <div class="modal-actions">
        <button type="submit" class="btn">×©×œ×™×—×”</button>
        <button type="button" class="btn-ghost" onclick="closeBitModal()">×‘×™×˜×•×œ</button>
      </div>
    </form>
  </div>
</div>

<!-- ğŸ†• ××•×“××œ paybox: ×§×œ×™×˜×ª ×›×™× ×•×™ + ×¡×›×•× + ×ª×–×›×•×¨×ª ×¦×™×œ×•× ××¡×š -->
<div id="payboxModal" class="modal" aria-hidden="true">
  <div class="modal-box">
    <h3>PayBox â€” ×‘×§×©×ª ×˜×¢×™× ×”</h3>
    <form id="payboxForm">
      <div class="field">
        <label class="label" for="pb_nickname">×›×™× ×•×™ (×©× ×‘××¤×œ×™×§×¦×™×”)</label>
        <input class="input" id="pb_nickname" name="pb_nickname" placeholder="ClubGG name" autocomplete="off" required />
      </div>
      <div class="field">
        <label class="label" for="pb_amount">×¡×›×•× (â‚ª)</label>
        <input class="input" id="pb_amount" name="pb_amount" type="number" min="1" step="1" inputmode="numeric" placeholder="×œ××©×œ: 100" required />
        <div id="payboxError" class="error">×‘×“×•×§ ×©×”×›×™× ×•×™ ××•×œ× ×•×”×¡×›×•× ×’×“×•×œ ×Ö¾0.</div>
      </div>
      <div class="hint">××œ ×ª×©×›×—/×™ ×œ×¦×¨×£ <b>×¦×™×œ×•× ××¡×š</b> ×©×œ ×”×ª×©×œ×•× ×‘×”×•×“×¢×ª ×”×•×•×¦××¤.</div>
      <div class="modal-actions">
        <button type="button" class="btn-ghost" id="pb_wa_now">×©×œ×— ×•×•××¦××¤ ×¢×›×©×™×•</button>
        <button type="submit" class="btn">×”××©×š ×œ×¤×™×™×‘×•×§×¡</button>
        <button type="button" class="btn-ghost" id="pb_close">×‘×™×˜×•×œ</button>
      </div>
    </form>
  </div>
</div>

<!-- ğŸ†• ××•×“××œ ××©×™×›×•×ª: 4 ×©×“×•×ª + ×–×™×›×¨×•×Ÿ ×›×™× ×•×™/×ª×©×œ×•× -->
<div id="withdrawModal" class="modal" aria-hidden="true">
  <div class="modal-box">
    <h3>×‘×§×©×ª ××©×™×›×”</h3>
    <form id="withdrawForm">
      <div class="field">
        <label class="label" for="wd_withdraw">×›××” ×œ××©×•×š? (â‚ª)</label>
        <input class="input" id="wd_withdraw" name="wd_withdraw" type="number" min="1" step="1" inputmode="numeric" placeholder="×œ××©×œ: 200" required />
      </div>
      <div class="field">
        <label class="label" for="wd_keep">×›××” ×œ×”×©××™×¨? (â‚ª)</label>
        <input class="input" id="wd_keep" name="wd_keep" type="number" min="0" step="1" inputmode="numeric" placeholder="×œ××©×œ: 0" required />
      </div>
      <div class="field">
        <label class="label" for="wd_nick">×›×™× ×•×™ (×©× ×‘××¤×œ×™×§×¦×™×”)</label>
        <input class="input" id="wd_nick" name="wd_nick" placeholder="ClubGG name" autocomplete="off" required />
      </div>
      <div class="field">
        <label class="label" for="wd_pay">××•×¤×Ÿ ×ª×©×œ×•×</label>
        <select class="select" id="wd_pay" name="wd_pay">
          <option value="Bit">Bit</option>
          <option value="PayBox">PayBox</option>
        </select>
      </div>
      <div id="wd_error" class="error">×‘×“×•×§ ×©×›×œ ×”×©×“×•×ª ××•×œ××• ×›×¨××•×™.</div>

      <div class="hint">×œ××—×¨ ×©×œ×™×—×”: × ×¤×ª×— ×§×™×©×•×¨ ×”×§×‘×•×¦×” ×›×¨×’×™×œ, ×•×”×˜×§×¡×˜ ×™×•×¢×ª×§ â€” ×”×“×‘×§ ××•×ª×• ×‘×¦×³××˜ ×”×§×‘×•×¦×” ×•×©×œ×— âœ…</div>

      <div class="modal-actions">
        <button type="submit" class="btn">×©×œ×™×—×”</button>
        <button type="button" class="btn-ghost" id="wd_close">×‘×™×˜×•×œ</button>
      </div>
    </form>
  </div>
</div>

<div class="overlay">
  <h1>×”×¡× ×™×£ ×”×“×™×’×™×˜×œ×™</h1>

  <!-- ××¤×œ×™×§×¦×™×” -->
  <div class="section">
    <h2>ğŸ“± ××¤×œ×™×§×¦×™×”</h2>
    <div class="club-row">
      <span class="club-code-label">×§×•×“ ××•×¢×“×•×Ÿ:</span>
      <span class="club-code-badge" id="clubCode">715965</span>
      <button class="copy-btn" onclick="copyText(document.getElementById('clubCode').textContent)">ğŸ“‹ ×”×¢×ª×§</button>
    </div>
    <div class="store-links">
      <a href="https://apps.apple.com/us/app/clubgg-poker/id1529839330" target="_blank"><img src="app store.png" class="store-icon" alt="App Store"></a>
      <a href="https://play.google.com/store/apps/details?id=com.nsus.clubgg" target="_blank"><img src="android.png" class="store-icon" alt="Google Play"></a>
    </div>
  </div>

  <!-- ×˜×¢×™× ×•×ª -->
  <div class="section topup-section">
    <h2>ğŸ”‹ ×˜×¢×™× ×•×ª</h2>
    <div class="hint-top">×œ×—×¥ ×¢×œ ××—×ª ×”××•×¤×¦×™×•×ª ×œ×˜×¢×™× ×”</div>
    <div class="tiny-note"><b>×©×™××• â¤ï¸ ×˜×¢×™× ×•×ª ××ª×‘×¦×¢×•×ª ×›×œ ×™×•× ×‘×™×Ÿ 18:00 ×œÖ¾00:00</b></div>
    <div class="pay-actions">
      <a class="pay-btn" data-type="paybox" href="https://links.payboxapp.com/9kD9tKtOhWb" target="_blank">
        <img src="PayBox.png" class="pay-logo" alt="PayBox"><span class="pay-label">PayBox</span>
      </a>
      <button class="pay-btn" data-type="bit" onclick="startWhatsappFlow(this)">
        <img src="Bit.png" class="pay-logo" alt="bit"><span class="pay-label">bit</span>
      </button>
    </div>
    <div class="tiny-note">×‘×›×œ ×˜×¢×™× ×”, ×œ×©×œ×•×— ×¦×™×œ×•× ××¡×š ×•×›×™× ×•×™.</div>
    <div class="tiny-note"><b>×™×—×¡ ×¦×³×™×¤×™× 1:10</b></div>
  </div>

  <!-- ××©×™×›×•×ª -->
  <div class="section">
    <h2>ğŸ’¸ ××©×™×›×•×ª</h2>
    <div class="hours-pill">×›×œ ×™×•× ×©×œ×™×©×™ ×‘×™×Ÿ <b>18:00</b> ×œÖ¾<b>00:00</b></div>
    <a id="withdrawLink" href="https://chat.whatsapp.com/GDw1GilqCab6Un2TspiWBP?mode=wwc" target="_blank" class="link-btn">ğŸ’¬ ×œ×§×‘×•×¦×ª ×”-WhatsApp ×œ×‘×™×¦×•×¢ ××©×™×›×•×ª</a>
  </div>

  <footer>
    âš ï¸ ×©×—×§×• ×‘××—×¨×™×•×ª
    <div class="footer-sub">ğŸ¤ ×©××¨×• ×¢×œ ×”×§×”×™×œ×” ×©×œ× ×• â€“ ×œ× ××¤×¨×¡××™× ×§×œ××‘×™× ××• ××©×—×§×™× ××—×¨×™×.</div>
    <div class="footer-sub">×× ×—× ×• ×›××Ÿ ×›×“×™ ×œ×™×”× ×•×ª ×™×—×“, ×‘××•×•×™×¨×” ×˜×•×‘×” </div>
  </footer>
</div>

<script>
function copyText(t){ navigator.clipboard?.writeText(t).catch(()=>{}); }

/* === ××©××¨×•×ª (×›×‘×¨ ×§×™×™×) === */
function nowIL(){
  const d = new Date();
  const fmt = new Intl.DateTimeFormat('he-IL',{timeZone:'Asia/Jerusalem', hour12:false, hour:'2-digit', minute:'2-digit', weekday:'long'}).formatToParts(d);
  const get=t=>fmt.find(x=>x.type===t)?.value;
  const h=+get('hour'), m=+get('minute');
  const wd=(get('weekday')||'').trim();
  const mapLong={"×™×•× ×¨××©×•×Ÿ":0,"×™×•× ×©× ×™":1,"×™×•× ×©×œ×™×©×™":2,"×™×•× ×¨×‘×™×¢×™":3,"×™×•× ×—××™×©×™":4,"×™×•× ×©×™×©×™":5,"×©×‘×ª":6,"×™×•× ×©×‘×ª":6};
  const day=(wd in mapLong)?mapLong[wd]:d.getDay();
  return {day, minutes:h*60+m};
}
const STARTER_FOR_EVEN_DAY = '×××•×¨';
const STARTER_FOR_ODD_DAY  = '×¢×™×“×•';
function currentShiftOwner(){
  const n = nowIL();
  const shiftIndex = Math.floor(n.minutes/180);
  const dayStarter = (n.day%2===0)?STARTER_FOR_EVEN_DAY:STARTER_FOR_ODD_DAY;
  const other = (dayStarter==='×××•×¨')?'×¢×™×“×•':'×××•×¨';
  return (shiftIndex%2===0)?dayStarter:other;
}
function currentShiftEndTimeString(){
  const n = nowIL();
  const endIndex = Math.floor(n.minutes/180)+1;
  const endMinutes = Math.min(endIndex*180, 24*60);
  const hh = Math.floor((endMinutes%1440)/60).toString().padStart(2,'0');
  const mm = (endMinutes%60).toString().padStart(2,'0');
  return `${hh}:${mm}`;
}
function openShiftModal(){
  const name = currentShiftOwner();
  const until = currentShiftEndTimeString();
  const p = document.getElementById('shiftText');
  if(p) p.textContent = `×‘××©××¨×ª: ${name} Â· ×¢×“ ${until}`;
  document.getElementById('shiftModal')?.classList.add('show');
}
function closeShiftModal(){ document.getElementById('shiftModal')?.classList.remove('show'); }

/* === bit: ××•×“××œ + ×¤×ª×™×—×ª ×•×•××˜×¡××¤ === */

/* â¬‡ï¸ ×”××¡×¤×¨×™× ×‘×¤×•×¨××˜ ×‘×™× "×œ (×‘×œ×™ ××§×¤×™×/×¨×•×•×—×™×) */
const PHONE_MAOR = "972546819166";
const PHONE_IDO  = "972559877777";

function startWhatsappFlow(){
  openBitModal();
}

function openBitModal(){
  document.getElementById('bitModal')?.classList.add('show');
  setTimeout(()=>document.getElementById('nickname')?.focus(), 0);
}
function closeBitModal(){
  document.getElementById('bitModal')?.classList.remove('show');
}

document.getElementById('bitForm')?.addEventListener('submit', function(e){
  e.preventDefault();
  const nickname = (document.getElementById('nickname')?.value || '').trim();
  const amountStr = (document.getElementById('amount')?.value || '').trim();
  const amount = Number(amountStr);
  const err = document.getElementById('bitError');

  if(!nickname || !amount || amount <= 0){
    err?.classList.add('show');
    return;
  }
  err?.classList.remove('show');

  const who = currentShiftOwner(); // '×××•×¨' ××• '×¢×™×“×•'
  const phone = (who === '×××•×¨') ? PHONE_MAOR : PHONE_IDO;

  const text =
    `×”×˜×¢× ×ª×™ ×œ×š ×‘-Bit ×¡×›×•× ×©×œ ${amount} ×©"×—.\n` +
    `×”×›×™× ×•×™ ×©×œ×™ ×”×•×: ${nickname}\n` +
    `×ª×˜×¢×™×Ÿ ×œ×™ ×¦'×™×¤×™× ×‘×‘×§×©×” ğŸ¤‘`;

  const url = `https://wa.me/${phone}?text=${encodeURIComponent(text)}`;

  closeBitModal();
  window.open(url, '_blank');
});
</script>

<!-- ğŸ†• PayBox Flow (××ª×œ×‘×© ×‘×œ×™ ×œ×©×‘×•×¨ ×¢×™×¦×•×‘/×›×¤×ª×•×¨) -->
<script>
(function(){
  const payboxBtn = document.querySelector('.pay-actions [data-type="paybox"]');
  if(!payboxBtn) return;
  const payboxHref = payboxBtn.getAttribute('href') || 'https://links.payboxapp.com/9kD9tKtOhWb';

  // ××•×“××œ PayBox
  const pbModal = document.getElementById('payboxModal');
  const pbForm  = document.getElementById('payboxForm');
  const pbNick  = document.getElementById('pb_nickname');
  const pbAmt   = document.getElementById('pb_amount');
  const pbErr   = document.getElementById('payboxError');
  const pbClose = document.getElementById('pb_close');
  const pbWaNow = document.getElementById('pb_wa_now');

  let armedForAutoWA = false;
  let waUrlCache = '';

  function openPbModal(){
    pbModal?.classList.add('show');
    setTimeout(()=>pbNick?.focus(),0);
  }
  function closePbModal(){
    pbModal?.classList.remove('show');
  }
  function currentPhone(){
    const who = currentShiftOwner();
    return (who === '×××•×¨') ? PHONE_MAOR : PHONE_IDO;
  }
  function buildWA(username, amount, method){
    const who = currentShiftOwner();
    const name = who;
    return `×”×™×™ ${name}, ×‘×™×¦×¢×ª×™ ×ª×©×œ×•× ×‘"${method}".\n` +
           `×©× ××©×ª××©: ${username}\n×¡×›×•× ×”×˜×¢× ×”: ${amount} â‚ª\n×××¦×¢×™: ${method}\n` +
           `×× × ××©×¨/×™ ×˜×¢×™× ×”. (× × ×œ×¦×¨×£ ×¦×™×œ×•× ××¡×š ××”×ª×©×œ×•×)`;
  }
  function validate(){
    const nickname = (pbNick?.value || '').trim();
    const amountStr = (pbAmt?.value || '').trim();
    const amount = Number(amountStr);
    if(!nickname || !amount || amount <= 0){
      pbErr?.classList.add('show');
      return null;
    }
    pbErr?.classList.remove('show');
    return { nickname, amount };
  }
  function openWA(){
    if(!waUrlCache) return;
    window.open(waUrlCache, '_blank');
    waUrlCache = '';
    armedForAutoWA = false;
  }

  // ×ª×•×¤×¡×™× ××ª ×§×œ×™×§ ×”-PayBox (×‘×œ×™ ×œ×©× ×•×ª HTML/×¢×™×¦×•×‘)
  payboxBtn.addEventListener('click', function(ev){
    ev.preventDefault();
    ev.stopPropagation();
    openPbModal();
  }, true);

  // â€œ×©×œ×— ×•×•××¦××¤ ×¢×›×©×™×•â€
  pbWaNow?.addEventListener('click', function(){
    const v = validate(); if(!v) return;
    const phone = currentPhone();
    const text = buildWA(v.nickname, v.amount, 'PayBox');
    waUrlCache = `https://wa.me/${phone}?text=${encodeURIComponent(text)}`;
    window.open(waUrlCache, '_blank');
  });

  // â€œ×”××©×š ×œ×¤×™×™×‘×•×§×¡â€ â†’ ×¤×•×ª×— ×§×‘×•×¦×”; ×›×©×—×•×–×¨×™× ××¦×™×¢ ×•×•××¦××¤
  pbForm?.addEventListener('submit', function(e){
    e.preventDefault();
    const v = validate(); if(!v) return;

    const phone = currentPhone();
    const text  = buildWA(v.nickname, v.amount, 'PayBox');
    waUrlCache  = `https://wa.me/${phone}?text=${encodeURIComponent(text)}`;

    closePbModal();
    window.open(payboxHref, '_blank'); // ×××©×™×š ×œ×”×ª× ×”×’ ×›××• ×”×™×•× (target=_blank)
    armedForAutoWA = true;
  });

  pbClose?.addEventListener('click', closePbModal);

  // ×›×©×—×•×–×¨×™× ×œ×˜××‘ â€” ×œ×”×¦×™×¢ ×¤×ª×™×—×ª ×•×•××¦××¤
  window.addEventListener('visibilitychange', () => {
    if (!document.hidden && armedForAutoWA){
      const go = confirm('×—×–×¨×ª ××¤×™×™×‘×•×§×¡. ×œ×¤×ª×•×— ×•×•××¦××¤ ×•×œ×¦×¨×£ ×¦×™×œ×•× ××¡×š?');
      if (go) openWA();
    }
  });
  window.addEventListener('focus', () => {
    if (armedForAutoWA){
      const go = confirm('×œ×¤×ª×•×— ×•×•××¦××¤ ×œ×”×©×œ××ª ×”××™×©×•×¨?');
      if (go) openWA();
    }
  });
})();
</script>

<!-- ğŸ†• Withdraw Flow (Modal + ×”×–× ×ª ×¤×¨×˜×™× + ×–×™×›×¨×•×Ÿ + ×”×¢×ª×§×” + ×¤×ª×™×—×ª ×§×‘×•×¦×”) -->
<script>
(function(){
  // ××¦×‘×™×¢ ×œ×œ×™× ×§ ×”×§×‘×•×¦×” (×œ× ××©× ×™× hrefâ€”×¨×§ ××©×ª××©×™× ×‘×•)
  const withdrawLink = document.getElementById('withdrawLink');
  if (!withdrawLink) return;

  // ×—×™×–×•×§ ××‘×˜×—×”: rel
  withdrawLink.setAttribute('rel','noopener noreferrer');

  // ××•×“××œ
  const wdModal = document.getElementById('withdrawModal');
  const wdForm  = document.getElementById('withdrawForm');
  const wdW    = document.getElementById('wd_withdraw');
  const wdK    = document.getElementById('wd_keep');
  const wdNick = document.getElementById('wd_nick');
  const wdPay  = document.getElementById('wd_pay');
  const wdErr  = document.getElementById('wd_error');
  const wdClose= document.getElementById('wd_close');

  // Prefill ××”×–×™×›×¨×•×Ÿ (×›×™× ×•×™ + ×××¦×¢×™ ×ª×©×œ×•×)
  const LS_NICK = 'wd_nickname';
  const LS_PAY  = 'wd_paypref';
  function prefill(){
    const nick = localStorage.getItem(LS_NICK) || '';
    const pay  = localStorage.getItem(LS_PAY)  || 'Bit';
    if (nick) wdNick.value = nick;
    wdPay.value = (pay === 'PayBox' ? 'PayBox' : 'Bit');
  }

  function openWdModal(){
    prefill();
    wdModal?.classList.add('show');
    setTimeout(()=>wdW?.focus(),0);
  }
  function closeWdModal(){
    wdModal?.classList.remove('show');
  }

  function buildMsg(withdraw, keep, nick, pay){
    return `×”×™×™, ×× ×™ ×¨×•×¦×” ×œ××©×•×š ${withdraw} ×œ×”×©××™×¨ ${keep} ×”×›×™× ×•×™ ×©×œ×™ ×–×” ${nick}, ` +
           `×ª×¢×‘×™×¨ ×œ×™ ×‘${pay} ×ª×•×“×” ğŸ™‚.`;
  }

  function validate(){
    const withdraw = Number((wdW?.value || '').trim());
    const keep     = Number((wdK?.value || '').trim());
    const nick     = (wdNick?.value || '').trim();
    const pay      = (wdPay?.value || 'Bit');

    if (!withdraw || withdraw <= 0 || keep < 0 || !nick){
      wdErr?.classList.add('show');
      return null;
    }
    wdErr?.classList.remove('show');
    return { withdraw, keep, nick, pay };
  }

  async function copyToClipboard(text){
    try { await navigator.clipboard.writeText(text); return true; }
    catch { return false; }
  }

  async function shareOrOpen(text){
    // 1) × ×¡×” native share (××›×©×™×¨×™× ×ª×•××›×™×)
    if (navigator.share && /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent)) {
      try { await navigator.share({ text }); return true; } catch {}
    }
    // 2) ×¤×ª×— wa.me ×¢× ×˜×§×¡×˜ (×”××©×ª××© ×‘×•×—×¨ ×™×¢×“)
    window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
    return true;
  }

  // ×ª×•×¤×¡×™× ××ª ×”×œ×—×™×¦×” ×•××¦×™×’×™× ××•×“××œ ×‘××§×•× ×¤×ª×™×—×” ×™×©×™×¨×”
  withdrawLink.addEventListener('click', function(ev){
    ev.preventDefault();
    ev.stopPropagation();
    openWdModal();
  }, true);

  // ×›×¤×ª×•×¨ ×‘×™×˜×•×œ
  wdClose?.addEventListener('click', closeWdModal);

  // ×©×œ×™×—×”
  wdForm?.addEventListener('submit', async function(e){
    e.preventDefault();
    const v = validate(); if (!v) return;

    // ×©×•××¨×™× ×œ×–×™×›×¨×•×Ÿ: ×›×™× ×•×™ + ×××¦×¢×™ ×ª×©×œ×•× ××•×¢×“×£
    localStorage.setItem(LS_NICK, v.nick);
    localStorage.setItem(LS_PAY,  v.pay);

    const message = buildMsg(v.withdraw, v.keep, v.nick, v.pay);

    // ××¢×ª×™×§×™× ×œ×˜×•×‘×ª ×”×“×‘×§×” ××”×™×¨×”
    const copied = await copyToClipboard(message);

    // ×¤×•×ª×—×™× ××ª ×”×§×‘×•×¦×” ×‘×œ×©×•× ×™×ª ×—×“×©×” â€” ×‘×“×™×•×§ ×›××• ×”×™×•×
    window.open(withdrawLink.href, '_blank');

    // × ×•×ª× ×™× ×“×¨×š ××”×™×¨×” ×’× ×“×¨×š WhatsApp ×›×œ×œ×™ (××©×ª××© ×‘×•×—×¨ ×§×‘×•×¦×”)
    await shareOrOpen(message);

    // ×¤×™×“×‘×§ ×‘×¨×•×¨ ×œ××©×ª××©
    alert(copied
      ? "×”×˜×§×¡×˜ ×”×•×¢×ª×§ ×œ×œ×•×—. ×”×“×‘×§ ×‘×§×‘×•×¦×ª ×”-WhatsApp ×©× ×¤×ª×—×” ×•×©×œ×— âœ…"
      : "××™ ××¤×©×¨ ×”×™×” ×œ×”×¢×ª×™×§ ×œ×œ×•×—. ×”×˜×§×¡×˜ × ×¤×ª×— ×‘-WhatsApp â€” ×× ×¦×¨×™×š, ×—×–×•×¨ ×œ×›××Ÿ ×•×”×¢×ª×§ ×™×“× ×™×ª.");

    closeWdModal();
  });
})();
</script>

</body>
</html>
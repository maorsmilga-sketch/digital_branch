<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>הסניף הדיגיטלי</title>
<style>
  body {
    font-family: 'Heebo', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    background-image: url('background.png');
    background-size: cover; background-position: center;
    color: #f7f7f2;
    margin: 0; padding: 20px;
    text-align: center;
  }

  .overlay {
    background: rgba(0,0,0,.55);
    border-radius: 16px;
    padding: 18px;
    margin: 0 auto;
    width: 92%; max-width: 640px;
    box-shadow: 0 0 18px rgba(0,0,0,.35);
  }

  h1 { margin: 0 0 12px; font-size: 2.2rem; }

  .bar-top {
    display: flex; justify-content: space-between; align-items: center; gap: 12px;
    margin-bottom: 10px;
  }

  /* כפתור אימוג'י למשמרת */
  .who-emoji {
    width: 42px; height: 42px;
    background: none; border: none; cursor: pointer;
    transition: transform .15s ease; border-radius: 50%;
  }
  .who-emoji:hover { transform: scale(1.08); }
  .who-emoji img { width: 100%; height: 100%; border-radius: 50%; display: block; }

  .section {
    background: rgba(0,0,0,.55);
    padding: 16px; border-radius: 12px;
    margin: 16px auto 0; text-align: right; direction: rtl;
    border: 1px solid rgba(255,255,255,0.08);
  }
  .section h2 { margin: 0 0 12px; text-align: right; }

  a { color: #22d3ee; text-decoration: underline; font-weight: 600; }

  .copy-btn {
    background-color: #2b7bff; color: #fff; border: none;
    border-radius: 6px; padding: 6px 10px; margin-right: 6px; cursor: pointer;
  }
  .copy-btn:hover { background-color: #1763de; }

  .btn-wa {
    background: linear-gradient(135deg, #0b7a55, #064e3b);
    color: #fff; border: none; border-radius: 26px;
    padding: 10px 18px; font-size: .95rem; cursor: pointer;
    margin-top: 10px; transition: .2s; display: inline-flex; align-items: center; gap: 8px;
  }
  .btn-wa:hover { transform: translateY(-1px); }

  .tiny-note { font-size: .85em; opacity: .9; margin-top: 6px; }
  .micro-note { font-size: .75em; opacity: .85; margin-top: 4px; }
  .space-top { margin-top: 10px; }

  footer { margin-top: 18px; font-weight: 700; font-size: 1.1rem; color: #ffdf91; }

  .footer-sub { font-weight: 500; font-size: .85rem; color: #ffe9b6; margin-top: 6px; }
  .footer-sub.smaller { font-size: .8rem; opacity: .95; }

  .clubgg-logo { width: 38px; vertical-align: middle; margin-left: 8px; border-radius: 8px; }

  /* ===== Modals (חלוניות) ===== */
  .modal {
    display: none; position: fixed; inset: 0;
    background: rgba(0,0,0,.6); z-index: 9999;
    align-items: center; justify-content: center;
  }
  .modal-box {
    background: rgba(1,59,51,.96);
    border: 1px solid rgba(255,255,255,.15);
    width: 88%; max-width: 380px;
    color: #fff; text-align: center;
    padding: 22px; border-radius: 14px;
    box-shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  .modal-box h3 { margin: 0 0 8px; color: #ffdf91; }
  .modal-actions { margin-top: 12px; display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
  .btn {
    border: none; border-radius: 8px; padding: 8px 14px; cursor: pointer;
    color: #fff; background: #2b7bff;
  }
  .btn:hover { background: #1b63e8; }
  .btn-ghost { background: transparent; border: 1px solid rgba(255,255,255,.3); }
  .btn-ghost:hover { background: rgba(255,255,255,.1); }

  .amount-input, .text-input, .select-input {
    width: 86%; padding: 10px; border-radius: 10px; border: none;
    text-align: center; font-size: 1rem; outline: none;
    background: rgba(255,255,255,.15); color: #fff;
    display:block; margin: 0 auto 8px;
  }
  .amount-input::placeholder, .text-input::placeholder { color: #e8e8e8; opacity: .75; }
  .select-input { cursor: pointer; }
</style>
</head>
<body>
  <div class="overlay">
    <div class="bar-top">
      <h1>הסניף הדיגיטלי</h1>
      <!-- אייקון "מי במשמרת?" -->
      <button class="who-emoji" title="מי במשמרת עכשיו?" onclick="openShiftModal()">
        <img src="shift.png" alt="מי במשמרת">
      </button>
    </div>

    <!-- אפליקציה -->
    <div class="section">
      <h2><img src="clubgg-logo-new.png?v=3" alt="ClubGG Logo" class="clubgg-logo"> אפליקציה</h2>
      <div>
        <b>קוד מועדון:</b> 715965
        <button class="copy-btn" onclick="copyText('715965')">📋 העתק</button>
      </div>
      <div class="space-top">
        📲 <a href="https://apps.apple.com/us/app/clubgg-poker/id1529839330" target="_blank" rel="noopener">iPhone (App Store)</a> |
        <a href="https://play.google.com/store/apps/details?id=com.nsus.clubgg" target="_blank" rel="noopener">Android (Google Play)</a>
      </div>
    </div>

    <!-- טעינות -->
    <div class="section">
      <h2>🔋 טעינות</h2>
      <div>
        🔗 <b>Paybox:</b>
        <a href="https://links.payboxapp.com/9kD9tKtOhWb" target="_blank" rel="noopener">טען עכשיו ב-Paybox</a>
      </div>
      <button class="btn-wa" onclick="startWhatsappFlow()">אין לך PayBox? דבר איתי ב-WhatsApp 💬</button>
      <div class="tiny-note space-top">💬 בכל טעינה, לשלוח צילום מסך ושם משתמש ב-WhatsApp.</div>
      <div class="tiny-note"><b>יחס צ׳יפים 1:10</b></div>
    </div>

    <!-- משיכות -->
    <div class="section">
      <h2>💸 משיכות</h2>
      <div>כל יום שלישי בין <b>18:00</b> ל-<b>00:00</b></div>
      <a href="https://chat.whatsapp.com/GDw1GilqCab6Un2TspiWBP" target="_blank" rel="noopener" id="withdrawGroupLink">
        💬 לקבוצת ה-WhatsApp לביצוע משיכות לחצו כאן
      </a>
      <div class="micro-note">* ניתן לבצע משיכה רק בימי שלישי בין 18:00 ל-00:00.</div>
      <button class="btn-wa" onclick="openWithdrawModal()">בקשת משיכה 💬</button>
    </div>

    <footer>
      ⚠️ שחקו באחריות
      <div class="footer-sub smaller">🤝 שמרו על הקהילה שלנו – לא מפרסמים קלאבים או משחקים אחרים.</div>
      <div class="footer-sub smaller">אנחנו כאן כדי ליהנות יחד, באווירה טובה ומשפחה אחת</div>
    </footer>
  </div>

  <!-- Modal: מחוץ לשעות פעילות (נשאר בקוד למקרה שתרצה להחזיר בעתיד, אך לא בשימוש כעת) -->
  <div id="closedModal" class="modal" aria-hidden="true">
    <div class="modal-box">
      <h3>הסניף הדיגיטלי</h3>
      <p>🔒 לא זמינים כרגע – זמינים להטענות בין <b>18:00</b> ל-<b>00:00</b></p>
      <button class="btn" onclick="closeClosedModal()">הבנתי</button>
    </div>
  </div>

  <!-- Modal: הזנת סכום + כינוי (טעינות) -->
  <div id="amountModal" class="modal" aria-hidden="true">
    <div class="modal-box">
      <h3>הסניף הדיגיטלי 💬</h3>
      <p>כמה ₪ תרצה להטעין, ומה הכינוי שלך באפליקציה?</p>

      <input id="amountInput" class="amount-input" type="number" min="1" step="1"
             placeholder="סכום (לדוגמה: 50)" inputmode="numeric" aria-label="סכום להטעין">

      <input id="nicknameInput" class="text-input" type="text" maxlength="30"
             placeholder="כינוי באפליקציה (לדוגמה: Maor123)" aria-label="כינוי באפליקציה">

      <div class="modal-actions">
        <button class="btn" onclick="confirmAmount()">אישור</button>
        <button class="btn btn-ghost" onclick="closeAmountModal()">ביטול</button>
      </div>
    </div>
  </div>

  <!-- Modal: בקשת משיכה (4 שדות) -->
  <div id="withdrawModal" class="modal" aria-hidden="true">
    <div class="modal-box">
      <h3>בקשת משיכה 💸</h3>
      <p>מלא/י את הפרטים ונכין לך הודעה לקבוצת המשיכות:</p>

      <input id="wdAmount" class="amount-input" type="number" min="1" step="1"
             placeholder="כמה כסף? (לדוגמה: 200)" inputmode="numeric" aria-label="סכום למשיכה">

      <input id="wdKeep" class="amount-input" type="number" min="0" step="1"
             placeholder="כמה להשאיר? (לדוגמה: 50)" inputmode="numeric" aria-label="כמה להשאיר">

      <input id="wdNick" class="text-input" type="text" maxlength="30"
             placeholder="כינוי באפליקציה (לדוגמה: Maor123)" aria-label="כינוי באפליקציה">

      <select id="wdMethod" class="select-input" aria-label="אופן תשלום">
        <option value="">בחר אופן תשלום</option>
        <option value="ביט">ביט</option>
        <option value="פייבוקס">פייבוקס</option>
      </select>

      <div class="modal-actions">
        <button class="btn" onclick="confirmWithdraw()">אישור</button>
        <button class="btn btn-ghost" onclick="closeWithdrawModal()">ביטול</button>
        <button class="btn btn-ghost" onclick="openWithdrawGroup()">פתח את קבוצת המשיכות</button>
      </div>
    </div>
  </div>

  <!-- Modal: מי במשמרת -->
  <div id="shiftModal" class="modal" aria-hidden="true">
    <div class="modal-box">
      <h3>מי במשמרת עכשיו?</h3>
      <p id="shiftText">—</p>
      <button class="btn" onclick="closeShiftModal()">סגור</button>
    </div>
  </div>

<script>
  // טלפונים בפורמט וואטסאפ
  const PHONES = { "מאור": "972546819166", "עידו": "972559877777" };

  // רוטציה לפי ימים (0=ראשון ... 6=שבת)
  const ROTA = {
    0: [ "מאור","עידו","מאור","עידו","מאור","עידו" ],
    1: [ "עידו","מאור","עידו","מאור","עידו","מאור" ],
    2: [ "מאור","עידו","מאור","עידו","מאור","עידו" ],
    3: [ "עידו","מאור","עידו","מאור","עידו","מאור" ],
    4: [ "מאור","עידו","מאור","עידו","מאור","עידו" ],
    5: [ "עידו","מאור","עידו","מאור","עידו","מאור" ],
    6: [ "מאור","עידו","מאור","עידו","מאור","עידו" ]
  };

  const BLOCKS = [
    { start: "08:00", end: "12:00", idx: 0 },
    { start: "12:00", end: "15:00", idx: 1 },
    { start: "15:00", end: "18:00", idx: 2 },
    { start: "18:00", end: "21:00", idx: 3 },
    { start: "21:00", end: "24:00", idx: 4 },
    { start: "00:00", end: "01:00", idx: 5 }
  ];

  const amountModal = document.getElementById('amountModal');
  const closedModal = document.getElementById('closedModal');
  const shiftModal  = document.getElementById('shiftModal');
  const withdrawModal = document.getElementById('withdrawModal');

  const amountInput = document.getElementById('amountInput');
  const nicknameInput = document.getElementById('nicknameInput');

  const wdAmount = document.getElementById('wdAmount');
  const wdKeep   = document.getElementById('wdKeep');
  const wdNick   = document.getElementById('wdNick');
  const wdMethod = document.getElementById('wdMethod');

  const withdrawGroupLink = document.getElementById('withdrawGroupLink');
  const WITHDRAW_GROUP_URL = withdrawGroupLink?.getAttribute('href') || "";

  function toMin(hhmm){ const [h,m]=hhmm.split(':').map(Number); return h*60+(m||0); }
  function displayEnd(end){ return end==="24:00" ? "00:00" : end; }

  // זמן נוכחי באזור זמן ישראל
  function nowIL(){
    const parts = new Intl.DateTimeFormat("he-IL", {
      timeZone: "Asia/Jerusalem", hour12:false, hour:"2-digit", minute:"2-digit", weekday:"short"
    }).formatToParts(new Date());
    const g = t => parts.find(p=>p.type===t)?.value;
    const hour = Number(g("hour")), minute = Number(g("minute"));
    const weekday = g("weekday");
    const map = {"יום א׳":0,"יום ב׳":1,"יום ג׳":2,"יום ד׳":3,"יום ה׳":4,"יום ו׳":5,"יום ש׳":6,"יום שבת":6};
    const day = map[weekday] ?? new Date().getDay();
    return { day, minutes: hour*60+minute };
  }

  function currentShift(){
    const n = nowIL();
    for(const b of BLOCKS){
      const s = toMin(b.start), e = toMin(b.end);
      const inBlock = (s < e) ? (n.minutes >= s && n.minutes < e) : (n.minutes >= s || n.minutes < e);
      if(inBlock){
        const who = ROTA[n.day][b.idx];
        return { active: true, who, phone: PHONES[who], until: displayEnd(b.end) };
      }
    }
    return { active: false };
  }

  // ==== טעינות: וואטסאפ תמיד עובד + כינוי ====
  let pendingPhone = null;

  function startWhatsappFlow(){
    const s = currentShift();
    const fallback = PHONES["מאור"] || Object.values(PHONES)[0];
    pendingPhone = (s.active && s.phone) ? s.phone : fallback;
    openAmountModal();
  }

  function openAmountModal(){
    amountModal.style.display = "flex";
    setTimeout(()=> (amountInput.value ? nicknameInput : amountInput).focus(), 50);
  }
  function closeAmountModal(){ amountModal.style.display = "none"; }

  function confirmAmount(){
    const rawAmount = (amountInput.value || '').trim();
    const amount = Math.floor(Number(rawAmount));
    const nick = (nicknameInput.value || '').trim();

    if(!rawAmount || !Number.isFinite(amount) || amount <= 0){
      amountInput.focus(); amountInput.select?.(); return;
    }
    if(nick.length < 2){
      nicknameInput.focus(); return;
    }

    const msg =
      `היי! רוצה להטעין לסניף הדיגיטלי סכום של ${amount} ₪.\n` +
      `הכינוי שלי באפליקציה: ${nick}`;

    const fallback = PHONES["מאור"] || Object.values(PHONES)[0];
    const target = pendingPhone || fallback;

    window.open(`https://wa.me/${target}?text=${encodeURIComponent(msg)}`,"_blank");

    amountInput.value = "";
    nicknameInput.value = "";
    closeAmountModal();
  }

  // ==== משיכות: חלונית ויצירת הודעה לקבוצה ====
  function openWithdrawModal(){
    withdrawModal.style.display = "flex";
    setTimeout(()=> wdAmount.focus(), 50);
  }
  function closeWithdrawModal(){ withdrawModal.style.display = "none"; }

  function confirmWithdraw(){
    const rawA = (wdAmount.value || '').trim();
    const rawK = (wdKeep.value || '').trim();
    const nick = (wdNick.value || '').trim();
    const method = wdMethod.value;

    const amount = Math.floor(Number(rawA));
    const keep   = Math.floor(Number(rawK || "0"));

    if(!rawA || !Number.isFinite(amount) || amount <= 0){
      wdAmount.focus(); wdAmount.select?.(); return;
    }
    if(keep < 0){
      wdKeep.focus(); wdKeep.select?.(); return;
    }
    if(nick.length < 2){
      wdNick.focus(); return;
    }
    if(method !== 'ביט' && method !== 'פייבוקס'){
      wdMethod.focus(); return;
    }

    const text =
      `בקשת משיכה:\n` +
      `• סכום למשיכה: ${amount} ₪\n` +
      `• להשאיר: ${keep} ₪\n` +
      `• כינוי באפליקציה: ${nick}\n` +
      `• אופן תשלום: ${method}`;

    // פתיחת וואטסאפ עם טקסט מוכן לבחירת יעד (אפשר לבחור את קבוצת המשיכות)
    window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, "_blank");

    wdAmount.value = "";
    wdKeep.value = "";
    wdNick.value = "";
    wdMethod.value = "";
    closeWithdrawModal();
  }

  // --- משיכות: בדיקת חלון זמן ושלישי הקרוב ---
  function isWithdrawWindowOpen() {
    // חלון משיכות: יום שלישי 18:00–24:00 (00:00)
    const n = nowIL();
    const TUE = 2;
    const start = 18 * 60;   // 18:00
    const end   = 24 * 60;   // 24:00
    return n.day === TUE && n.minutes >= start && n.minutes < end;
  }

  function nextWithdrawDateString() {
    // אם זה שלישי לפני 18:00 -> היום; אחרת שלישי הבא
    const n = nowIL();
    const now = new Date();
    const TUE = 2;
    const start = 18 * 60;

    let addDays;
    if (n.day === TUE && n.minutes < start) {
      addDays = 0; // היום בערב
    } else {
      addDays = (TUE - n.day + 7) % 7;
      if (addDays === 0) addDays = 7; // אם כבר עבר החלון היום
    }

    const target = new Date(now.getFullYear(), now.getMonth(), now.getDate() + addDays);
    return new Intl.DateTimeFormat('he-IL', {
      timeZone: 'Asia/Jerusalem',
      weekday: 'long', day: '2-digit', month: '2-digit', year: 'numeric'
    }).format(target);
  }

  function openWithdrawGroup() {
    if (isWithdrawWindowOpen()) {
      if (WITHDRAW_GROUP_URL) window.open(WITHDRAW_GROUP_URL, "_blank");
    } else {
      alert(`לא כרגע 🙂\nהמשיכות מתבצעות ביום שלישי בין 18:00–00:00.\nהמועד הקרוב: ${nextWithdrawDateString()} בין 18:00–00:00.`);
    }
  }

  // ודא שלחיצה על הלינק תמיד תעבור דרך הבדיקה
  if (withdrawGroupLink) {
    withdrawGroupLink.addEventListener('click', (e) => {
      e.preventDefault();
      openWithdrawGroup();
    });
  }

  // ==== חלוניות נוספות ====
  function openClosedModal(){ closedModal.style.display = "flex"; }
  function closeClosedModal(){ closedModal.style.display = "none"; }

  function openShiftModal(){
    const s = currentShift();
    const el = document.getElementById('shiftText');
    el.textContent = s.active ? `עכשיו במשמרת: ${s.who} (עד ${s.until})` : "כרגע לא בשעות פעילות";
    document.getElementById('shiftModal').style.display = "flex";
  }
  function closeShiftModal(){ document.getElementById('shiftModal').style.display = "none"; }

  // כלי
  function copyText(t){ navigator.clipboard.writeText(t); alert("הועתק!"); }
</script>
</body>
</html>

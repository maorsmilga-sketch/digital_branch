<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>הסניף הדיגיטלי</title>
<style>
:root{
  --fg:#f7f7f2; --glass:rgba(0,0,0,.55); --glass-brd:rgba(255,255,255,.08);
  --accent:#22d3ee; --btn:#2b7bff;
}
body{
  font-family:'Heebo',system-ui;
  background:url('background.png') center/cover no-repeat fixed;
  color:var(--fg); margin:0; text-align:center;
}
.overlay{
  width:min(640px,94%); margin:110px auto 20px; padding:18px 14px 20px;
  background:var(--glass); border:1px solid var(--glass-brd);
  border-radius:18px; box-shadow:0 0 20px rgba(0,0,0,.4);
}
h1{ margin:6px 0 8px; font-size:1.95rem; line-height:1.1; }

.section{
  background:rgba(0,0,0,.53); border:1px solid var(--glass-brd);
  border-radius:12px; padding:12px; margin:12px auto 0; text-align:right;
}
a{ color:var(--accent); font-weight:600; text-decoration:underline; }

.club-code{ font-size:1.9rem; font-weight:800; }
.copy-btn{ background:var(--btn); color:#fff; border:none; border-radius:6px; padding:6px 10px; cursor:pointer; }
.copy-btn:hover{ background:#1b63e8; }

.store-links{ display:flex; justify-content:center; gap:10px; margin-top:6px; }
.store-links a{ background:rgba(255,255,255,.1); padding:4px 6px; border-radius:8px; transition:.2s; }
.store-links a:hover{ transform:scale(1.05); background:rgba(255,255,255,.18); }
.store-icon{ width:65px; opacity:.95; }

.tiny-note{ font-size:.86em; opacity:.92; margin-top:6px; text-align:center; }
footer{ margin-top:14px; font-weight:700; font-size:1.05rem; color:#ffdf91; }
.footer-sub{ font-weight:500; font-size:.83rem; color:#ffe9b6; margin-top:6px; }

/* ===== כפתור משמרת צף ===== */
.shift-indicator{ position:fixed; top:12px; left:12px; z-index:9999; background:rgba(0,0,0,.55); border:1px solid rgba(255,255,255,.15); border-radius:12px; padding:6px; box-shadow:0 3px 10px rgba(0,0,0,.3); cursor:pointer; transition:transform .15s ease, background .15s ease; }
.shift-indicator:hover{ transform:scale(1.05); background:rgba(0,0,0,.65); }
.shift-indicator img{ width:42px; height:42px; border-radius:10px; display:block; }

/* ===== מודאל כללי ===== */
.modal{ position:fixed; inset:0; z-index:9998; display:flex; align-items:center; justify-content:center; opacity:0; visibility:hidden; pointer-events:none; background:rgba(0,0,0,0); transition:opacity .25s ease, visibility .25s ease, background .25s ease; }
.modal.show{ opacity:1; visibility:visible; pointer-events:auto; background:rgba(0,0,0,.55); }
.modal-box{ background:rgba(1,59,51,.96); border:1px solid rgba(255,255,255,.15); width:min(460px,92%); color:#fff; text-align:right; padding:18px; border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.35); }
.modal-box h3{ margin:0 0 12px; color:#ffdf91; font-size:1.2rem; }
.modal-actions{ margin-top:12px; display:flex; justify-content:flex-start; gap:8px; }
.btn{ border:none; border-radius:8px; padding:8px 14px; cursor:pointer; color:#fff; background:var(--btn); }
.btn:hover{ background:#1b63e8; }
.btn-ghost{ background:transparent; border:1px solid rgba(255,255,255,.3); }
.btn-ghost:hover{ background:rgba(255,255,255,.1); }

/* ===== שדות מודאל ===== */
.field{ display:flex; flex-direction:column; gap:6px; margin:10px 0; }
.label{ font-size:.95rem; opacity:.95; }
.input, .select{
  background:rgba(255,255,255,.1); border:1px solid rgba(255,255,255,.25);
  color:#fff; border-radius:10px; padding:10px; font-size:1rem; outline:none;
}
.input:focus, .select:focus{ border-color:var(--accent); box-shadow:0 0 0 3px rgba(34,211,238,.25); }
.hint{ font-size:.82rem; opacity:.9; }
.error{ font-size:.86rem; color:#ffd1d1; display:none; }
.error.show{ display:block; }
</style>
</head>
<body>

<!-- כפתור משמרת -->
<div class="shift-indicator" onclick="openShiftModal()" title="מי במשמרת עכשיו?">
  <img src="shift.png" alt="משמרת">
</div>

<!-- מודאל משמרת -->
<div id="shiftModal" class="modal" aria-hidden="true">
  <div class="modal-box">
    <h3>🕓 מי במשמרת עכשיו?</h3>
    <p id="shiftText">טוען...</p>
    <div class="modal-actions">
      <button class="btn" onclick="closeShiftModal()">הבנתי</button>
    </div>
  </div>
</div>

<!-- מודאל bit: כינוי + סכום -->
<div id="bitModal" class="modal" aria-hidden="true">
  <div class="modal-box">
    <h3>bit — בקשת טעינה</h3>
    <form id="bitForm">
      <div class="field">
        <label class="label" for="nickname">כינוי (שם באפליקציה)</label>
        <input class="input" id="nickname" name="nickname" placeholder="למשל: Arsen" autocomplete="off" required />
      </div>
      <div class="field">
        <label class="label" for="amount">סכום (₪)</label>
        <input class="input" id="amount" name="amount" type="number" min="1" step="1" inputmode="numeric" placeholder="למשל: 50" required />
        <div id="bitError" class="error">בדוק שהכינוי מולא והסכום גדול מ־0.</div>
      </div>
      <div class="hint">לאחר שליחה נפתח וואטסאפ אל מי שבמשמרת עם הודעה מוכנה.</div>
      <div class="modal-actions">
        <button type="submit" class="btn">שליחה</button>
        <button type="button" class="btn-ghost" onclick="closeBitModal()">ביטול</button>
      </div>
    </form>
  </div>
</div>

<!-- מודאל משיכות: 5 שדות -->
<div id="withdrawModal" class="modal" aria-hidden="true">
  <div class="modal-box">
    <h3>משיכות — הודעה לקבוצת ה-WhatsApp</h3>
    <form id="withdrawForm">
      <div class="field">
        <label class="label" for="w_amount">סכום למשיכה (₪)</label>
        <input class="input" id="w_amount" type="number" min="1" step="1" inputmode="numeric" placeholder="למשל: 100" required />
      </div>
      <div class="field">
        <label class="label" for="w_leave">כמה להשאיר? (₪)</label>
        <input class="input" id="w_leave" type="number" min="0" step="1" inputmode="numeric" placeholder="למשל: 20" required />
      </div>
      <div class="field">
        <label class="label" for="w_nick">כינוי</label>
        <input class="input" id="w_nick" placeholder="למשל: Arsen" autocomplete="off" required />
      </div>
      <div class="field">
        <label class="label" for="w_phone">טלפון</label>
        <input class="input" id="w_phone" placeholder="למשל: 050-1234567" autocomplete="tel" required />
      </div>
      <div class="field">
        <label class="label" for="w_method">אופן תשלום</label>
        <select class="select" id="w_method" required>
          <option value="" disabled selected>בחר...</option>
          <option>Bit</option>
          <option>PayBox</option>
        </select>
      </div>

      <div id="withdrawError" class="error">אנא מלא/י את כל השדות הנדרשים בצורה תקינה.</div>

      <div class="hint">נעתיק את ההודעה אוטומטית ללוח ונפתח את קבוצת המשיכות. הדבק ושלח 🙂</div>
      <div class="modal-actions">
        <button type="submit" class="btn">המשך</button>
        <button type="button" class="btn-ghost" onclick="closeWithdrawModal()">ביטול</button>
      </div>
    </form>
  </div>
</div>

<div class="overlay">
  <h1>הסניף הדיגיטלי</h1>

  <!-- אפליקציה -->
  <div class="section">
    <h2>📱 אפליקציה</h2>
    <div class="club-row">
      <span class="club-code-label">קוד מועדון:</span>
      <span class="club-code-badge" id="clubCode">715965</span>
      <button class="copy-btn" onclick="copyText(document.getElementById('clubCode').textContent)">📋 העתק</button>
    </div>
    <div class="store-links">
      <a href="https://apps.apple.com/us/app/clubgg-poker/id1529839330" target="_blank"><img src="app store.png" class="store-icon" alt="App Store"></a>
      <a href="https://play.google.com/store/apps/details?id=com.nsus.clubgg" target="_blank"><img src="android.png" class="store-icon" alt="Google Play"></a>
    </div>
  </div>

  <!-- טעינות -->
  <div class="section topup-section">
    <h2>🔋 טעינות</h2>
    <div class="hint-top">לחץ על אחת האופציות לטעינה</div>
    <div class="tiny-note"><b>שימו ❤️ טעינות מתבצעות כל יום בין 18:00 ל־00:00</b></div>
    <div class="pay-actions">
      <a class="pay-btn" data-type="paybox" href="https://links.payboxapp.com/9kD9tKtOhWb" target="_blank">
        <img src="PayBox.png" class="pay-logo" alt="PayBox"><span class="pay-label">PayBox</span>
      </a>
      <button class="pay-btn" data-type="bit" onclick="startWhatsappFlow(this)">
        <img src="Bit.png" class="pay-logo" alt="bit"><span class="pay-label">bit</span>
      </button>
    </div>
    <div class="tiny-note">בכל טעינה, לשלוח צילום מסך וכינוי.</div>
    <div class="tiny-note"><b>יחס צ׳יפים 1:10</b></div>
  </div>

  <!-- משיכות -->
  <div class="section">
    <h2>💸 משיכות</h2>
    <div class="hours-pill">כל יום שלישי בין <b>18:00</b> ל־<b>00:00</b></div>
    <!-- פתיחת מודאל 5 שדות; לאחר אישור נפתח קישור הקבוצה -->
    <a id="withdrawLink" href="https://chat.whatsapp.com/GDw1GilqCab6Un2TspiWBP?mode=wwc" target="_blank" class="link-btn" onclick="return openWithdrawModal(event)">💬 לקבוצת ה-WhatsApp לביצוע משיכות</a>
  </div>

  <footer>
    ⚠️ שחקו באחריות
    <div class="footer-sub">🤝 שמרו על הקהילה שלנו – לא מפרסמים קלאבים או משחקים אחרים.</div>
    <div class="footer-sub">אנחנו כאן כדי ליהנות יחד, באווירה טובה </div>
  </footer>
</div>

<script>
function copyText(t){ navigator.clipboard?.writeText(t).catch(()=>{}); }

/* === משמרות (קיים) === */
function nowIL(){
  const d = new Date();
  const fmt = new Intl.DateTimeFormat('he-IL',{timeZone:'Asia/Jerusalem', hour12:false, hour:'2-digit', minute:'2-digit', weekday:'long'}).formatToParts(d);
  const get=t=>fmt.find(x=>x.type===t)?.value;
  const h=+get('hour'), m=+get('minute');
  const wd=(get('weekday')||'').trim();
  const mapLong={"יום ראשון":0,"יום שני":1,"יום שלישי":2,"יום רביעי":3,"יום חמישי":4,"יום שישי":5,"שבת":6,"יום שבת":6};
  const day=(wd in mapLong)?mapLong[wd]:d.getDay();
  return {day, minutes:h*60+m};
}
const STARTER_FOR_EVEN_DAY = 'מאור';
const STARTER_FOR_ODD_DAY  = 'עידו';
function currentShiftOwner(){
  const n = nowIL();
  const shiftIndex = Math.floor(n.minutes/180);
  const dayStarter = (n.day%2===0)?STARTER_FOR_EVEN_DAY:STARTER_FOR_ODD_DAY;
  const other = (dayStarter==='מאור')?'עידו':'מאור';
  return (shiftIndex%2===0)?dayStarter:other;
}
function currentShiftEndTimeString(){
  const n = nowIL();
  const endIndex = Math.floor(n.minutes/180)+1;
  const endMinutes = Math.min(endIndex*180, 24*60);
  const hh = Math.floor((endMinutes%1440)/60).toString().padStart(2,'0');
  const mm = (endMinutes%60).toString().padStart(2,'0');
  return `${hh}:${mm}`;
}
function openShiftModal(){
  const name = currentShiftOwner();
  const until = currentShiftEndTimeString();
  const p = document.getElementById('shiftText');
  if(p) p.textContent = `במשמרת: ${name} · עד ${until}`;
  document.getElementById('shiftModal')?.classList.add('show');
}
function closeShiftModal(){ document.getElementById('shiftModal')?.classList.remove('show'); }

/* === bit: מודאל + פתיחת וואטסאפ (כפי שהיה) === */
const PHONE_MAOR = "972546819166";
const PHONE_IDO  = "972559877777";
function startWhatsappFlow(){ openBitModal(); }
function openBitModal(){
  document.getElementById('bitModal')?.classList.add('show');
  setTimeout(()=>document.getElementById('nickname')?.focus(), 0);
}
function closeBitModal(){ document.getElementById('bitModal')?.classList.remove('show'); }
document.getElementById('bitForm')?.addEventListener('submit', function(e){
  e.preventDefault();
  const nickname = (document.getElementById('nickname')?.value || '').trim();
  const amountStr = (document.getElementById('amount')?.value || '').trim();
  const amount = Number(amountStr);
  const err = document.getElementById('bitError');
  if(!nickname || !amount || amount <= 0){ err?.classList.add('show'); return; }
  err?.classList.remove('show');
  const who = currentShiftOwner(); // 'מאור' או 'עידו'
  const phone = (who === 'מאור') ? PHONE_MAOR : PHONE_IDO;
  const text =
    `הטענתי לך ב-Bit סכום של ${amount} ש"ח.\n` +
    `הכינוי שלי הוא: ${nickname}\n` +
    `תטעין לי צ'יפים בבקשה 🤑`;
  const url = `https://wa.me/${phone}?text=${encodeURIComponent(text)}`;
  closeBitModal();
  window.open(url, '_blank');
});

/* === העדפות משיכה (localStorage) === */
const LS_KEYS = {
  nick:  'withdraw_nick',
  phone: 'withdraw_phone',
  method:'withdraw_method',
};
function loadWithdrawPrefs() {
  return {
    nick:   localStorage.getItem(LS_KEYS.nick)   || '',
    phone:  localStorage.getItem(LS_KEYS.phone)  || '',
    method: localStorage.getItem(LS_KEYS.method) || '',
  };
}
function saveWithdrawPrefs(nick, phone, method) {
  try {
    localStorage.setItem(LS_KEYS.nick,   nick || '');
    localStorage.setItem(LS_KEYS.phone,  phone || '');
    localStorage.setItem(LS_KEYS.method, method || '');
  } catch (_) {}
}

/* === משיכות: מודאל 5 שדות, העתקה אוטומטית, פתיחת הקבוצה === */
function openWithdrawModal(ev){
  if(ev) ev.preventDefault();
  document.getElementById('withdrawModal')?.classList.add('show');

  // טען העדפות ושחזר לשדות
  const prefs = loadWithdrawPrefs();
  const nickEl   = document.getElementById('w_nick');
  const phoneEl  = document.getElementById('w_phone');
  const methodEl = document.getElementById('w_method');

  if (nickEl && !nickEl.value)   nickEl.value = prefs.nick;
  if (phoneEl && !phoneEl.value) phoneEl.value = prefs.phone;
  if (methodEl && prefs.method)  methodEl.value = prefs.method;

  setTimeout(()=>document.getElementById('w_amount')?.focus(), 0);
  return false; // מונע מהקישור לנווט מיד
}
function closeWithdrawModal(){
  document.getElementById('withdrawModal')?.classList.remove('show');
}

document.getElementById('withdrawForm')?.addEventListener('submit', async function(e){
  e.preventDefault();
  const amount   = (document.getElementById('w_amount')?.value || '').trim();
  const leaveAmt = (document.getElementById('w_leave')?.value || '').trim();
  const nick     = (document.getElementById('w_nick')?.value || '').trim();
  const phone    = (document.getElementById('w_phone')?.value || '').trim();
  const method   = (document.getElementById('w_method')?.value || '').trim();
  const errEl    = document.getElementById('withdrawError');

  if(!amount || Number(amount) <= 0 || !leaveAmt || Number(leaveAmt) < 0 || !nick || !phone || !method){
    errEl?.classList.add('show');
    return;
  }
  errEl?.classList.remove('show');

  // שמור העדפות לשימוש עתידי (המשתמש תמיד יכול לשנות ידנית)
  saveWithdrawPrefs(nick, phone, method);

  // לפי התבנית שסיפקת (שני מופעים של "תעביר לי ב ...")
  const text =
    `היי, אני רוצה למשוך ${amount} ` +
    `השם שלי הוא ${nick} ` +
    `אני רוצה להשאיר ${leaveAmt} ` +
    `תעביר לי ב ${method} ` +
    `תעביר לי ב ${method} , ` +
    `המספר טלפון שלי הוא ${phone}`;

  try { await navigator.clipboard.writeText(text); } catch(e) {}

  const groupUrl = document.getElementById('withdrawLink')?.href || '';
  closeWithdrawModal();
  if(groupUrl) window.open(groupUrl, '_blank');
});

/* (רשות) שמירה תוך כדי הקלדה/בחירה */
['w_nick','w_phone','w_method'].forEach(id=>{
  const el = document.getElementById(id);
  if(!el) return;
  const handler = () => {
    const nick   = document.getElementById('w_nick')?.value || '';
    const phone  = document.getElementById('w_phone')?.value || '';
    const method = document.getElementById('w_method')?.value || '';
    saveWithdrawPrefs(nick, phone, method);
  };
  el.addEventListener('change', handler);
  el.addEventListener('blur', handler);
});
</script>
</body>
</html>
